# AI 客服系統營運測試指南

本文檔定義 AI 客服系統的季度測試流程與驗收標準。

---

## 測試目的

1. **確保 NLU 準確性**：意圖識別與實體提取的正確率
2. **驗證多輪對話**：上下文理解與狀態管理
3. **檢查政策一致性**：價格、流程、政策資訊是否正確
4. **發現邊界情況**：錯誤處理與 fallback 機制
5. **監控用戶滿意度**：主觀體驗與實際使用反饋

---

## 季度測試流程

### 第一階段：測試場景準備（1-2 天）

#### 1.1 抽樣對話收集

從實際對話記錄中抽樣 50-100 筆對話，涵蓋：

- **意圖分布**：
  - greeting (10%)
  - service_inquiry (30%)
  - price_inquiry (20%)
  - booking_inquiry (15%)
  - comparison (10%)
  - complaint (5%)
  - handoff_to_human (5%)
  - goodbye (5%)

- **客戶角色分布**：
  - student_graduating (30%)
  - pro_switching_job (30%)
  - family_keeper (25%)
  - hr_corporate (15%)

- **服務類型分布**：
  - headshot_korean (25%)
  - portrait_pro (30%)
  - portrait_grad_personal (20%)
  - group_family (15%)
  - workshop_challenge (10%)

#### 1.2 測試案例標記

為每筆對話標記：

- **意圖標籤**：實際意圖 vs AI 識別意圖
- **實體標籤**：service_type, persona, use_case 等
- **正確性標籤**：✅ 正確 / ⚠️ 部分正確 / ❌ 錯誤
- **問題類型**：價格錯誤、政策錯誤、理解錯誤、流程錯誤

---

### 第二階段：自動化測試執行（1 天）

#### 2.1 執行測試腳本

```bash
npm run test-scenarios
```

測試腳本會：

1. 讀取 `docs/test-scenarios/test-cases.json`
2. 對每個測試案例發送請求到 `/api/chat`
3. 驗證回應格式與內容
4. 生成測試報告

#### 2.2 關鍵場景測試

**場景 1：新客戶諮詢**
- 輸入：「我想拍形象照」
- 預期：識別為 `service_inquiry`，追問用途與身份
- 驗證：回覆包含服務說明與下一步選項

**場景 2：價格敏感客戶**
- 輸入：「證件照多少錢？會不會很貴？」
- 預期：提供價格範圍，強調「實際金額以現場公告為準」
- 驗證：價格數字來自 `knowledge/services.json`

**場景 3：企業客戶**
- 輸入：「公司 20 個人要拍形象照，怎麼報價？」
- 預期：識別為 `handoff_to_human`，提供 Email/電話
- 驗證：不提供具體報價，引導至真人

**場景 4：投訴處理**
- 輸入：「上次拍的照片我不滿意，可以退費嗎？」
- 預期：使用投訴處理模板，不承諾退費，引導至真人
- 驗證：不使用 LLM 自由生成補償方案

**場景 5：方案比較**
- 輸入：「證件照跟形象照差在哪？選哪個好？」
- 預期：比較兩者差異，根據用途推薦
- 驗證：回覆包含具體差異與推薦理由

---

### 第三階段：人工審查與標記（2-3 天）

#### 3.1 對話審查清單

對每筆抽樣對話，檢查：

- [ ] **意圖識別**：AI 識別的意圖是否正確？
- [ ] **實體提取**：service_type, persona, use_case 是否正確？
- [ ] **價格資訊**：所有價格數字是否與 `knowledge/services.json` 一致？
- [ ] **政策資訊**：改期、取消、隱私等政策是否正確？
- [ ] **上下文理解**：多輪對話中是否正確理解上下文？
- [ ] **回覆品質**：回覆是否友善、專業、有幫助？
- [ ] **錯誤處理**：遇到無法理解的情況是否正確 fallback？

#### 3.2 錯誤分類

將發現的錯誤分類：

1. **價格錯誤**：AI 回覆的價格與 JSON 不一致
2. **政策錯誤**：AI 回覆的政策與知識庫不一致
3. **理解錯誤**：意圖識別或實體提取錯誤
4. **流程錯誤**：多輪對話中狀態管理錯誤
5. **邊界情況**：未正確處理的特殊情況

---

### 第四階段：數據分析與報告（1 天）

#### 4.1 計算指標

**NLU 成功率**：
```
NLU 成功率 = (正確識別意圖數 + 正確提取實體數) / 總測試數 × 100%
目標：> 85%
```

**多輪對話正確率**：
```
多輪對話正確率 = 正確理解上下文的對話數 / 多輪對話總數 × 100%
目標：> 80%
```

**價格/政策一致性**：
```
一致性 = 價格/政策正確的回覆數 / 相關回覆總數 × 100%
目標：100%（零容忍）
```

**用戶滿意度**：
```
滿意度 = 評分 ≥ 4 分的測試數 / 總測試數 × 100%
目標：> 80%
```

#### 4.2 生成測試報告

建立 `docs/test-reports/YYYY-QX-report.md`，包含：

- 測試概況（測試日期、樣本數、測試人員）
- 指標摘要（各項指標達成率）
- 錯誤清單（分類統計與具體案例）
- 改進建議（優先級排序）
- 下次測試重點

---

## 邊界情況測試

### 無法理解（NLU 失敗）

**測試案例**：
- 輸入：「asdfghjkl」（無意義字串）
- 預期：回覆「抱歉，我沒有完全理解你的問題...」，提供快捷選項

### 轉真人觸發

**測試案例**：
- 輸入：「我要找真人客服」
- 預期：立即提供 Email/電話/IG，不嘗試繼續對話

### 資訊不足時的追問

**測試案例**：
- 輸入：「我想拍照」
- 預期：追問「想拍哪種類型的照片？」或「主要用途是什麼？」

### 技術錯誤處理

**測試案例**：
- 模擬 API timeout（> 10 秒）
- 預期：回覆「這次有點久，我怕系統卡住了...」，提供重試或轉真人選項

---

## 驗收指標（Success Metrics）

### 必須達成（Blocking）

- [ ] **價格/政策一致性 = 100%**：零錯誤容忍
- [ ] **Critical FAQ 強制從 JSON 回答**：所有 policy_* 類問題必須從 JSON 回答
- [ ] **投訴處理使用模板**：complaint intent 必須使用嚴格模板，不允許 LLM 自由生成

### 目標達成（Target）

- [ ] **NLU 成功率 ≥ 85%**
- [ ] **多輪對話正確率 ≥ 80%**
- [ ] **用戶滿意度 ≥ 80%**
- [ ] **錯誤處理覆蓋率 = 100%**：所有錯誤情境都有明確處理

### 持續改進（Continuous）

- [ ] **季度測試覆蓋率**：每季度至少測試 50 筆對話
- [ ] **錯誤修復率**：發現的錯誤在下次測試前修復 ≥ 90%
- [ ] **知識庫更新頻率**：價格/政策變更後 24 小時內更新 JSON

---

## 測試工具與腳本

### 測試腳本位置

- `scripts/test-scenarios.mjs`：自動化測試腳本
- `docs/test-scenarios/test-cases.json`：測試案例定義

### 測試報告模板

- `docs/test-reports/template.md`：測試報告模板

### 執行方式

```bash
# 執行所有測試場景
npm run test-scenarios

# 執行特定場景
npm run test-scenarios -- --scenario=price_inquiry

# 生成詳細報告
npm run test-scenarios -- --report
```

---

## 測試時間表

- **Q1 測試**：每年 1 月第一週
- **Q2 測試**：每年 4 月第一週
- **Q3 測試**：每年 7 月第一週
- **Q4 測試**：每年 10 月第一週

每次測試完成後，在 1 週內完成報告與改進清單。

---

## 緊急測試觸發條件

以下情況發生時，應立即執行測試（不限於季度）：

1. **價格/政策變更**：更新 JSON 後立即測試相關場景
2. **大量用戶投訴**：收到 3 筆以上相同問題的投訴
3. **系統更新**：LLM 模型或後端邏輯更新後
4. **知識庫重構**：JSON 結構或 ID 定義變更後

---

文件最後更新：2025-01-01

