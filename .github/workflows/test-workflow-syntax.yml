name: Test Workflow Syntax

on:
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼
  pull_request:
    paths:
      - '.github/workflows/**'
  push:
    branches:
      - main
    paths:
      - '.github/workflows/**'

jobs:
  validate-workflows:
    name: Validate Workflow Syntax
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Validate YAML syntax
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const path = require('path');
            
            const workflowsDir = '.github/workflows';
            const files = fs.readdirSync(workflowsDir).filter(f => f.endsWith('.yml') || f.endsWith('.yaml'));
            
            console.log(`æ‰¾åˆ° ${files.length} å€‹ workflow æ–‡ä»¶`);
            
            for (const file of files) {
              const filePath = path.join(workflowsDir, file);
              try {
                const content = fs.readFileSync(filePath, 'utf-8');
                
                // åŸºæœ¬æª¢æŸ¥
                if (!content.includes('name:')) {
                  throw new Error('ç¼ºå°‘ name æ¬„ä½');
                }
                if (!content.includes('on:')) {
                  throw new Error('ç¼ºå°‘ on è§¸ç™¼æ¢ä»¶');
                }
                if (!content.includes('jobs:')) {
                  throw new Error('ç¼ºå°‘ jobs å®šç¾©');
                }
                
                console.log(`âœ… ${file} - èªæ³•æ­£ç¢º`);
              } catch (error) {
                console.error(`âŒ ${file} - éŒ¯èª¤: ${error.message}`);
                core.setFailed(`Workflow ${file} èªæ³•éŒ¯èª¤: ${error.message}`);
              }
            }
      
      - name: List all workflows
        run: |
          echo "ğŸ“‹ æ‰€æœ‰ Workflow æ–‡ä»¶:"
          ls -la .github/workflows/
          echo ""
          echo "ğŸ“ Workflow æ–‡ä»¶å…§å®¹æ‘˜è¦:"
          for file in .github/workflows/*.yml; do
            echo ""
            echo "=== $(basename $file) ==="
            head -5 "$file"
          done

