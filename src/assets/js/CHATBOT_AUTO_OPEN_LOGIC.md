# 聊天機器人自動打開邏輯說明

## 修改內容

修改了 `shouldAutoOpen()` 函數，使電腦版只有首頁默認自動打開，其他分頁默認關閉。

## 邏輯流程

### 手機版（寬度 <= 480px）
- **默認狀態**：關閉
- **URL 參數覆蓋**：
  - `?chat=open` 或 `?chatbot=open` → 打開
  - `#chat` 或 `#chatbot` → 打開
- **不受 pageType 影響**

### 電腦版（寬度 > 480px）

#### 1. URL 參數優先級（最高）
- `?chat=open` 或 `?chatbot=open` → **強制打開**（無論頁面類型）
- `#chat` 或 `#chatbot` → **強制打開**（無論頁面類型）
- `?chat=close` 或 `?chatbot=close` → **強制關閉**（無論頁面類型）

#### 2. 默認行為（無 URL 參數時）
- **首頁** (`pageType === 'home'`)：**默認打開**
- **其他頁面** (`pageType !== 'home'`)：**默認關閉**

## 測試場景

### 場景 1：首頁（電腦版）
- **預期**：自動打開
- **測試**：訪問 `https://your-domain.com/`（電腦版）

### 場景 2：FAQ 頁面（電腦版）
- **預期**：默認關閉
- **測試**：訪問 `https://your-domain.com/guide/faq`（電腦版）

### 場景 3：首頁 + URL 參數關閉（電腦版）
- **預期**：關閉（URL 參數優先）
- **測試**：訪問 `https://your-domain.com/?chat=close`（電腦版）

### 場景 4：FAQ 頁面 + URL 參數打開（電腦版）
- **預期**：打開（URL 參數優先）
- **測試**：訪問 `https://your-domain.com/guide/faq?chat=open`（電腦版）

### 場景 5：手機版首頁
- **預期**：默認關閉
- **測試**：訪問 `https://your-domain.com/`（手機版，寬度 <= 480px）

### 場景 6：手機版 + URL 參數打開
- **預期**：打開
- **測試**：訪問 `https://your-domain.com/?chat=open`（手機版）

## 代碼變更

```javascript
// 修改前：電腦版所有頁面都默認打開
return true; // 網頁版預設自動開啟

// 修改後：只有首頁默認打開
return isHomePage; // 電腦版：首頁打開，其他頁面關閉
```

## 邊界情況處理

1. ✅ **pageType 未定義**：默認為 'home'（見 `base-layout.njk`）
2. ✅ **URL 參數優先級**：明確的 URL 參數會覆蓋默認行為
3. ✅ **手機版不受影響**：手機版邏輯保持不變
4. ✅ **響應式切換**：如果用戶調整窗口大小，需要重新加載頁面才會生效（這是預期行為）

## 注意事項

- 此邏輯在頁面加載時執行一次
- 如果用戶在頁面加載後調整窗口大小，不會自動觸發重新判斷
- 如果需要支持動態響應式切換，需要額外添加 `resize` 事件監聽器

