<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
  <title>{{ title }}｜好時有影 Golden Years</title>

  {# --- [ SEO 驗證成功 ] --- #}
  {% if seo and seo.description %}
    <meta name="description" content="{{ seo.description }}">
  {% endif %}
  <link rel="canonical" href="{{ metadata.url }}{{ page.url }}">
  
  {# --- [ Open Graph / Facebook ] --- #}
  {% set ogTitle = seo.ogTitle | default(title) %}
  {% set ogDescription = seo.ogDescription | default(seo.description | default("")) %}
  {% set ogImage = seo.ogImage | default(metadata.url + "/assets/images/ui/好時有影logo藍字透明底.png") %}
  {% set ogUrl = metadata.url + page.url %}
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ ogUrl }}">
  <meta property="og:title" content="{{ ogTitle }}">
  {% if ogDescription %}
  <meta property="og:description" content="{{ ogDescription }}">
  {% endif %}
  <meta property="og:image" content="{{ ogImage }}">
  <meta property="og:site_name" content="好時有影 Golden Years">
  <meta property="og:locale" content="zh_TW">
  
  {# --- [ Twitter Card ] --- #}
  {% set twitterTitle = seo.twitterTitle | default(title) %}
  {% set twitterDescription = seo.twitterDescription | default(seo.description | default("")) %}
  {% set twitterImage = seo.twitterImage | default(seo.ogImage | default(metadata.url + "/assets/images/ui/好時有影logo藍字透明底.png")) %}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@goldenyears_studio">
  <meta name="twitter:title" content="{{ twitterTitle }}">
  {% if twitterDescription %}
  <meta name="twitter:description" content="{{ twitterDescription }}">
  {% endif %}
  <meta name="twitter:image" content="{{ twitterImage }}">
  {# --- [ SEO 結束 ] --- #}
  
  {# --- [ Google Fonts ] --- #}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=La+Belle+Aurore&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
  
  {# --- [ Performance Optimization ] Inline CSS to eliminate render-blocking resources --- #}
  <style>
    {# Inline main.css (always included) #}
    {{ "/assets/css/main.css" | inlineCSS | safe }}
    
    {# Inline page-specific CSS from pageStyles front matter #}
    {# Note: If pageStyles includes main.css, it will be skipped to avoid duplication #}
    {% if pageStyles %}
      {% set cssFiles = pageStyles | extractCSSPaths %}
      {% set mainCssPath = "/assets/css/main.css" %}
      {% for cssFile in cssFiles %}
        {# Skip main.css if it's already included above #}
        {% if cssFile != mainCssPath %}
          {{ cssFile | inlineCSS | safe }}
        {% endif %}
      {% endfor %}
    {% endif %}
  </style>

  <link rel="apple-touch-icon" href="/assets/images/ui/apple-touch-icon-180.png">

  {# Page-specific extra head content (e.g., meta tags) #}
  {% if extraHead %}{{ extraHead | safe }}{% endif %}

  {# AI 客服 Widget - 在 body 結束前加載，見下方 #}

  {# Lighthouse 用的隱藏 heading 樣式 #}
  <style>
    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border-width: 0 !important;
    }
  </style>
</head>

<body class="text-slate-600 antialiased selection:bg-trust-100 selection:text-trust-900 font-sans flex flex-col min-h-screen bg-[#FDFBF7] overflow-x-hidden w-full max-w-[100vw] {% if pageType == 'home' %}page-home{% endif %}" style="background-image: url('data:image/svg+xml,%3Csvg width=\'100\' height=\'100\' viewBox=\'0 0 100 100\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noise\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.8\' numOctaves=\'4\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100\' height=\'100\' filter=\'url(%23noise)\' opacity=\'0.03\'/%3E%3C/svg%3E');">

    {# 只給螢幕閱讀器 / Lighthouse 用的隱藏 h1~h4 #}
    <h1 class="visually-hidden">好時有影 Golden Years 主網站</h1>
    <h2 class="visually-hidden">主導覽</h2>
    <h3 class="visually-hidden">導覽群組</h3>
    <h4 class="visually-hidden">導覽選單標題</h4>

    {% include "partials/navigation.njk" %}

    <main class="pt-16 sm:pt-20 pb-20 px-4 md:px-8 max-w-[1400px] mx-auto">
        {{ content | safe }}
    </main>

    <!-- Footer -->
    <footer class="mt-20 bg-[#FDFBF7] pt-16 pb-12 font-sans relative" style="padding-bottom: calc(3rem + env(safe-area-inset-bottom, 0));">
        <div class="footer-edge"></div>
        <div class="absolute top-0 left-0 w-full h-px border-t border-dashed border-sand-300 opacity-50"></div>

        <div class="container mx-auto px-4 max-w-[1400px] relative z-10" style="padding-left: calc(1rem + env(safe-area-inset-left, 0)); padding-right: calc(1rem + env(safe-area-inset-right, 0));">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 mb-16">
                
                <!-- Left: Locations -->
                <div class="lg:col-span-7 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="group border-l-2 border-sand-200 pl-6 hover:border-trust-950 transition-colors">
                        <h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">LOCATION_01</h4>
                        <h3 class="text-xl font-bold text-trust-950 mb-2">中山店 <span class="font-serif italic font-normal text-lg">Zhongshan</span></h3>
                        <p class="text-sm text-slate-600 mb-3 leading-relaxed font-mono text-xs">台北市中山區南京東路1段10號4樓</p>
                        <div class="flex items-center gap-2 text-xxs text-slate-500 mb-3 bg-white border border-sand-200 px-2 py-1 rounded w-fit font-mono">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> 捷運中山站 2號出口
                        </div>
                        <a href="tel:0227092224" class="text-sm font-bold text-trust-900 border-b border-sand-300 hover:border-trust-900 transition-all pb-0.5 no-underline font-mono">TEL: 02-2709-2224</a>
                    </div>

                    <div class="group border-l-2 border-sand-200 pl-6 hover:border-trust-950 transition-colors">
                        <h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">LOCATION_02</h4>
                        <h3 class="text-xl font-bold text-trust-950 mb-2">公館店 <span class="font-serif italic font-normal text-lg">Gongguan</span></h3>
                        <p class="text-sm text-slate-600 mb-3 leading-relaxed font-mono text-xs">台北市中正區汀州路三段160巷4號6樓</p>
                        <div class="flex items-center gap-2 text-xxs text-slate-500 mb-3 bg-white border border-sand-200 px-2 py-1 rounded w-fit font-mono">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> 捷運公館站 1號出口
                        </div>
                        <a href="tel:0229365460" class="text-sm font-bold text-trust-900 border-b border-sand-300 hover:border-trust-900 transition-all pb-0.5 no-underline font-mono">TEL: 02-2936-5460</a>
                    </div>
                </div>

                <!-- Right: Brand -->
                <div class="lg:col-span-5 flex flex-col justify-between lg:items-end text-left lg:text-right">
                    <div>
                        <a href="/" class="inline-block mb-6 group no-underline">
                            <img
                                src="{{ 'ui/好時有影logo藍字透明底.png' | r2img }}"
                                alt="好時有影 Golden Years Logo"
                                width="160"
                                height="160"
                                class="h-24 w-auto object-contain max-w-[240px]"
                                onerror="this.onerror=null; this.src='/assets/images/ui/好時有影logo藍字透明底.png';"
                            />
                        </a>
                        <p class="text-sm text-slate-600 leading-7 mb-8 max-w-sm ml-auto">
                            讓每一個「好時」，都有你我的「身影」。<br>
                            我們相信，一張好的形象照，是職涯自信的起點。
                        </p>
                        <ul class="space-y-3 text-sm flex flex-col lg:items-end font-mono text-xs">
                            <li class="flex items-center gap-3 lg:flex-row-reverse">
                                <span class="text-slate-400">INSTAGRAM</span>
                                <a href="https://www.instagram.com/goldenyears_studio/" target="_blank" rel="noopener" class="text-trust-900 font-bold hover:text-slate-900 transition-colors no-underline">@goldenyears_studio</a>
                            </li>
                            <li class="flex items-center gap-3 lg:flex-row-reverse">
                                <span class="text-slate-400">CONTACT</span>
                                <a href="mailto:goldenyears166@gmail.com" class="text-slate-600 hover:text-trust-900 transition-colors no-underline">goldenyears166@gmail.com</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="pt-8 border-t border-sand-200 flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-xxs font-mono text-slate-400 uppercase tracking-wider">
                    © 2025 Golden Years Studio. All rights reserved.
                </div>
                <div class="font-hand text-2xl text-slate-400 select-none transform -rotate-2">
                    See you at the top.
                </div>
            </div>
        </div>
    </footer>

    {# [ V9.0 ] 載入新的 JS 檔案 #}
    <script src="/assets/js/main.js"></script>
    {# Scroll-triggered animations module #}
    <script src="/assets/js/scroll-animations.js"></script>
    
    {# ========================================
       AI 客服 Widget - 已遷移到獨立服務
       ======================================== #}
    {# 
      舊版引用（已停用）:
      <div data-chatbot-config data-page-type="{{ pageType | default('other') }}" style="display: none;" aria-hidden="true"></div>
      <script src="/assets/js/gy-chatbot.js" defer></script>
      <script src="/assets/js/gy-chatbot-init.js" defer></script>
    #}

    {# 生產環境 - 使用 Chatbot Service #}
    <script 
      src="https://chatbot-service-9qg.pages.dev/widget/loader.js" 
      data-company="goldenyears"
      data-api-endpoint="https://chatbot-service-9qg.pages.dev/api/goldenyears/chat"
      data-api-base-url="https://chatbot-service-9qg.pages.dev"
      data-page-type="{{ pageType | default('other') }}"
      data-auto-open="false"
      data-mobile-auto-open="false"
      defer
    ></script>
    <script>
      // 確保手機版 widget 默認關閉
      window.addEventListener('DOMContentLoaded', function() {
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth < 768;
        if (isMobile && window.goldenyearsChatbot) {
          // 如果 widget 已經載入，確保它是關閉的
          try {
            window.goldenyearsChatbot.close();
          } catch(e) {
            // Widget 可能尚未初始化，忽略錯誤
          }
        }
      });
    </script>
    
    {# 
      自定義域名版本（當 DNS 配置完成後使用）:
      
      <script 
        src="https://chatbot-api.goldenyearsphoto.com/widget/loader.js" 
        data-company="goldenyears"
        data-api-endpoint="https://chatbot-api.goldenyearsphoto.com/api/goldenyears/chat"
        data-api-base-url="https://chatbot-api.goldenyearsphoto.com"
        data-page-type="{{ pageType | default('other') }}"
        data-auto-open="{{ 'true' if pageType == 'home' else 'false' }}"
        defer
      ></script>
    #}

    {# 
      本地測試用（開發時取消註解，生產環境註解掉）:
      
      <script 
        src="http://localhost:8788/widget/loader.js" 
        data-company="goldenyears"
        data-api-endpoint="http://localhost:8788/api/goldenyears/chat"
        data-api-base-url="http://localhost:8788"
        data-page-type="{{ pageType | default('other') }}"
        data-auto-open="{{ 'true' if pageType == 'home' else 'false' }}"
        defer
      ></script>
    #}
    
</body>
</html>
