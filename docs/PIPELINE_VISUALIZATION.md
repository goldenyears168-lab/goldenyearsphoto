# Pipeline æ¨¡å¼è¦–è¦ºåŒ–å±•ç¤º

## ğŸ¨ Pipeline æ¨¡å¼çš„æ ¸å¿ƒå„ªå‹¢

Pipeline æ¨¡å¼æœ€å¤§çš„å„ªå‹¢æ˜¯**å¯è¦–åŒ–åŸ·è¡Œæµç¨‹**ï¼Œé¡ä¼¼ n8nã€Zapier ç­‰ç„¡ä»£ç¢¼å¹³å°ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„è¦–è¦ºåŒ–å±•ç¤ºã€‚

---

## ğŸ“Š 1. Pipeline åŸ·è¡Œæµç¨‹åœ–

### ASCII æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI å®¢æœæ©Ÿå™¨äºº Pipeline                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   [è«‹æ±‚é€²å…¥]
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. validateRequest  â”‚  âœ… é©—è­‰è«‹æ±‚æ ¼å¼ã€CORSã€åƒæ•¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. initializeServicesâ”‚  âœ… è¼‰å…¥çŸ¥è­˜åº«ã€åˆå§‹åŒ– LLMã€Context Manager
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. contextManagement â”‚  âœ… ç²å–æˆ–å‰µå»ºå°è©±ä¸Šä¸‹æ–‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. intentExtraction  â”‚  âœ… æ„åœ–åˆ†é¡ã€å¯¦é«”æå–ã€åˆä½µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. stateTransition   â”‚  âœ… æ±ºå®šä¸‹ä¸€å€‹å°è©±ç‹€æ…‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. specialIntents    â”‚  âš ï¸ ç‰¹æ®Šæ„åœ–è™•ç†ï¼ˆå¯èƒ½æå‰é€€å‡ºï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚       â”‚
  æ˜¯      å¦
    â”‚       â”‚
    â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚é€€å‡º â”‚  â”‚ 7. faqCheck          â”‚  âš ï¸ FAQ åŒ¹é…ï¼ˆå¯èƒ½æå‰é€€å‡ºï¼‰
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
        â”Œâ”€â”€â”€â”´â”€â”€â”€â”
        â”‚       â”‚
      æ˜¯      å¦
        â”‚       â”‚
        â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚é€€å‡º â”‚  â”‚ 8. llmGeneration     â”‚  âœ… ä½¿ç”¨ LLM ç”Ÿæˆå›æ‡‰
    â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ 9. buildResponse     â”‚  âœ… æ§‹å»ºæœ€çµ‚éŸ¿æ‡‰
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      è¿”å›éŸ¿æ‡‰        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   99. error-handler  â”‚  âš ï¸ çµ±ä¸€éŒ¯èª¤è™•ç†ï¼ˆåƒ…åœ¨éŒ¯èª¤æ™‚åŸ·è¡Œï¼‰
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ 2. åŸ·è¡Œæµç¨‹è¦–è¦ºåŒ–ï¼ˆæ™‚é–“è»¸ï¼‰

### æ­£å¸¸åŸ·è¡Œæµç¨‹

```
æ™‚é–“è»¸ â†’  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç¯€é» 1:  [â–ˆâ–ˆâ–ˆâ–ˆ] validateRequest (5ms)
ç¯€é» 2:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] initializeServices (120ms)
ç¯€é» 3:  [â–ˆâ–ˆ] contextManagement (2ms)
ç¯€é» 4:  [â–ˆâ–ˆâ–ˆâ–ˆ] intentExtraction (8ms)
ç¯€é» 5:  [â–ˆâ–ˆâ–ˆ] stateTransition (3ms)
ç¯€é» 6:  [â–ˆ] specialIntents (1ms) â†’ ç¹¼çºŒ
ç¯€é» 7:  [â–ˆâ–ˆ] faqCheck (2ms) â†’ ç¹¼çºŒ
ç¯€é» 8:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] llmGeneration (1800ms)
ç¯€é» 9:  [â–ˆâ–ˆ] buildResponse (3ms)

ç¸½è€—æ™‚: ~1944ms
```

### FAQ æå‰é€€å‡ºæµç¨‹

```
æ™‚é–“è»¸ â†’  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç¯€é» 1:  [â–ˆâ–ˆâ–ˆâ–ˆ] validateRequest (5ms)
ç¯€é» 2:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] initializeServices (120ms)
ç¯€é» 3:  [â–ˆâ–ˆ] contextManagement (2ms)
ç¯€é» 4:  [â–ˆâ–ˆâ–ˆâ–ˆ] intentExtraction (8ms)
ç¯€é» 5:  [â–ˆâ–ˆâ–ˆ] stateTransition (3ms)
ç¯€é» 6:  [â–ˆ] specialIntents (1ms) â†’ ç¹¼çºŒ
ç¯€é» 7:  [â–ˆâ–ˆ] faqCheck (2ms) â†’ âš ï¸ åŒ¹é…æˆåŠŸï¼Œæå‰é€€å‡º

ç¸½è€—æ™‚: ~141ms (ç¯€çœ ~1800ms LLM èª¿ç”¨)
```

---

## ğŸ“ˆ 3. çµæ§‹åŒ–æ—¥èªŒè¦–è¦ºåŒ–

### Pipeline æ—¥èªŒè¼¸å‡ºæ ¼å¼

```
â„¹ï¸  [Pipeline:validateRequest] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: validateRequest
âœ… [Pipeline:validateRequest] [SUCCESS] ç¯€é» validateRequest åŸ·è¡Œå®Œæˆ (5ms)

â„¹ï¸  [Pipeline:initializeServices] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: initializeServices
âœ… [Pipeline:initializeServices] [SUCCESS] ç¯€é» initializeServices åŸ·è¡Œå®Œæˆ (120ms)

â„¹ï¸  [Pipeline:contextManagement] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: contextManagement
âœ… [Pipeline:contextManagement] [SUCCESS] ç¯€é» contextManagement åŸ·è¡Œå®Œæˆ (2ms)

â„¹ï¸  [Pipeline:intentExtraction] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: intentExtraction
âœ… [Pipeline:intentExtraction] [SUCCESS] ç¯€é» intentExtraction åŸ·è¡Œå®Œæˆ (8ms)

â„¹ï¸  [Pipeline:stateTransition] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: stateTransition
âœ… [Pipeline:stateTransition] [SUCCESS] ç¯€é» stateTransition åŸ·è¡Œå®Œæˆ (3ms)

â„¹ï¸  [Pipeline:specialIntents] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: specialIntents
âœ… [Pipeline:specialIntents] [SUCCESS] ç¯€é» specialIntents åŸ·è¡Œå®Œæˆ (1ms)

â„¹ï¸  [Pipeline:faqCheck] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: faqCheck
âœ… [Pipeline:faqCheck] [SUCCESS] ç¯€é» faqCheck åŸ·è¡Œå®Œæˆ (2ms)

â„¹ï¸  [Pipeline:llmGeneration] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: llmGeneration
âœ… [Pipeline:llmGeneration] [SUCCESS] ç¯€é» llmGeneration åŸ·è¡Œå®Œæˆ (1800ms)

â„¹ï¸  [Pipeline:buildResponse] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: buildResponse
âœ… [Pipeline:buildResponse] [SUCCESS] ç¯€é» buildResponse åŸ·è¡Œå®Œæˆ (3ms)

[Chat] service_inquiry - 1944ms
```

### éŒ¯èª¤å ´æ™¯æ—¥èªŒ

```
â„¹ï¸  [Pipeline:validateRequest] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: validateRequest
âœ… [Pipeline:validateRequest] [SUCCESS] ç¯€é» validateRequest åŸ·è¡Œå®Œæˆ (5ms)

â„¹ï¸  [Pipeline:initializeServices] [INFO] é–‹å§‹åŸ·è¡Œç¯€é»: initializeServices
âŒ [Pipeline:initializeServices] [ERROR] ç¯€é» initializeServices åŸ·è¡Œå¤±æ•—: Failed to load knowledge base (120ms)

[Chat Error] ========== ERROR START ==========
[Chat Error] Error type: Error
[Chat Error] Error message: Failed to load knowledge base
[Chat Error] Knowledge base loading failed - this is likely the root cause
[Chat Error] ========== ERROR END ==========
```

---

## ğŸ†š 4. èˆŠæ¶æ§‹ vs Pipeline æ¶æ§‹å°æ¯”

### èˆŠæ¶æ§‹ï¼ˆå–®ä¸€å‡½æ•¸ï¼Œ400+ è¡Œï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              onRequestPost() [400+ è¡Œ]                    â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ‰€æœ‰é‚è¼¯æ··åœ¨ä¸€èµ·ï¼Œé›£ä»¥è¿½è¹¤åŸ·è¡Œæµç¨‹                â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â€¢ è«‹æ±‚é©—è­‰                                      â”‚  â”‚
â”‚  â”‚  â€¢ æœå‹™åˆå§‹åŒ–                                    â”‚  â”‚
â”‚  â”‚  â€¢ ä¸Šä¸‹æ–‡ç®¡ç†                                    â”‚  â”‚
â”‚  â”‚  â€¢ æ„åœ–åˆ†é¡                                      â”‚  â”‚
â”‚  â”‚  â€¢ å¯¦é«”æå–                                      â”‚  â”‚
â”‚  â”‚  â€¢ ç‹€æ…‹è½‰æ›                                      â”‚  â”‚
â”‚  â”‚  â€¢ ç‰¹æ®Šæ„åœ–è™•ç†                                  â”‚  â”‚
â”‚  â”‚  â€¢ FAQ æª¢æŸ¥                                      â”‚  â”‚
â”‚  â”‚  â€¢ LLM ç”Ÿæˆ                                      â”‚  â”‚
â”‚  â”‚  â€¢ éŸ¿æ‡‰æ§‹å»º                                      â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  âš ï¸ é›£ä»¥èª¿è©¦                                     â”‚  â”‚
â”‚  â”‚  âš ï¸ é›£ä»¥æ¸¬è©¦                                     â”‚  â”‚
â”‚  â”‚  âš ï¸ é›£ä»¥ç¶­è­·                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pipeline æ¶æ§‹ï¼ˆæ¨¡å¡ŠåŒ–ï¼Œ9 å€‹ç¯€é»ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              onRequestPost() [~10 è¡Œ]                     â”‚
â”‚                                                          â”‚
â”‚  å‰µå»º Pipeline â†’ è¨»å†Šç¯€é» â†’ åŸ·è¡Œ Pipeline                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          Pipeline æ¡†æ¶              â”‚
        â”‚                                     â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
        â”‚  â”‚ ç¯€é» 1  â”‚â†’â”‚ ç¯€é» 2  â”‚â†’ ...      â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
        â”‚                                     â”‚
        â”‚  â€¢ çµ±ä¸€åŸ·è¡Œé‚è¼¯                      â”‚
        â”‚  â€¢ çµæ§‹åŒ–æ—¥èªŒ                        â”‚
        â”‚  â€¢ éŒ¯èª¤è™•ç†                          â”‚
        â”‚  â€¢ æå‰é€€å‡º                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¯€é»æ–‡ä»¶ 1 â”‚  â”‚  ç¯€é»æ–‡ä»¶ 2 â”‚  â”‚  ç¯€é»æ–‡ä»¶ N â”‚
â”‚  (ç¨ç«‹æ¸¬è©¦) â”‚  â”‚  (ç¨ç«‹æ¸¬è©¦) â”‚  â”‚  (ç¨ç«‹æ¸¬è©¦) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… æ¸…æ™°çš„å¯è¦–åŒ–æµç¨‹
âœ… æ¯å€‹ç¯€é»ç¨ç«‹å¯æ¸¬è©¦
âœ… æ˜“æ–¼èª¿è©¦å’Œç¶­è­·
```

---

## ğŸ“‹ 5. ç¯€é»ä¾è³´é—œä¿‚åœ–

### æ•¸æ“šæµè¦–è¦ºåŒ–

```
Input (Request)
    â”‚
    â”œâ”€â†’ [1] validateRequest
    â”‚       â”‚
    â”‚       â”œâ”€â†’ ctx.body
    â”‚       â””â”€â†’ ctx.corsHeaders
    â”‚
    â”œâ”€â†’ [2] initializeServices
    â”‚       â”‚
    â”‚       â”œâ”€â†’ ctx.knowledgeBase
    â”‚       â”œâ”€â†’ ctx.llmService
    â”‚       â””â”€â†’ ctx.contextManager
    â”‚
    â”œâ”€â†’ [3] contextManagement
    â”‚       â”‚
    â”‚       â””â”€â†’ ctx.conversationContext
    â”‚
    â”œâ”€â†’ [4] intentExtraction
    â”‚       â”‚
    â”‚       â”œâ”€â†’ ctx.intent
    â”‚       â”œâ”€â†’ ctx.entities
    â”‚       â””â”€â†’ ctx.mergedEntities
    â”‚
    â”œâ”€â†’ [5] stateTransition
    â”‚       â”‚
    â”‚       â””â”€â†’ ctx.nextState
    â”‚
    â”œâ”€â†’ [6] specialIntents
    â”‚       â”‚
    â”‚       â”œâ”€â†’ [å¯èƒ½æå‰é€€å‡º] â†’ Response
    â”‚       â””â”€â†’ [ç¹¼çºŒ] â†’ ä¸‹ä¸€å€‹ç¯€é»
    â”‚
    â”œâ”€â†’ [7] faqCheck
    â”‚       â”‚
    â”‚       â”œâ”€â†’ [å¯èƒ½æå‰é€€å‡º] â†’ Response
    â”‚       â””â”€â†’ [ç¹¼çºŒ] â†’ ä¸‹ä¸€å€‹ç¯€é»
    â”‚
    â”œâ”€â†’ [8] llmGeneration
    â”‚       â”‚
    â”‚       â””â”€â†’ ctx.reply
    â”‚
    â””â”€â†’ [9] buildResponse
            â”‚
            â””â”€â†’ Response (æœ€çµ‚è¼¸å‡º)
```

---

## ğŸ¯ 6. Pipeline çš„é—œéµå„ªå‹¢ï¼ˆè¦–è¦ºåŒ–ï¼‰

### å„ªå‹¢ 1: å¯è¦–åŒ–åŸ·è¡Œæµç¨‹

```
âœ… èˆŠæ¶æ§‹: é›£ä»¥è¿½è¹¤åŸ·è¡Œæµç¨‹
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   é»‘ç›’å‡½æ•¸      â”‚  â† ç„¡æ³•çŸ¥é“å…§éƒ¨åŸ·è¡Œæƒ…æ³
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Pipeline: æ¸…æ™°çš„åŸ·è¡Œæ­¥é©Ÿ
   â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”
   â”‚ 1 â”‚â†’â”‚ 2 â”‚â†’â”‚ 3 â”‚â†’â”‚ 4 â”‚  â† æ¯ä¸€æ­¥éƒ½æ¸…æ™°å¯è¦‹
   â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜
```

### å„ªå‹¢ 2: çµæ§‹åŒ–æ—¥èªŒ

```
âœ… èˆŠæ¶æ§‹: åˆ†æ•£çš„ console.log
   console.log('Loading...')
   console.log('Initialized')
   console.log('Error:', error)  â† é›£ä»¥è¿½è¹¤

âœ… Pipeline: çµæ§‹åŒ–æ—¥èªŒ
   [Pipeline:validateRequest] [INFO] é–‹å§‹åŸ·è¡Œ
   [Pipeline:validateRequest] [SUCCESS] åŸ·è¡Œå®Œæˆ (5ms)
   [Pipeline:initializeServices] [ERROR] åŸ·è¡Œå¤±æ•—  â† æ¸…æ™°è¿½è¹¤
```

### å„ªå‹¢ 3: æå‰é€€å‡ºæ©Ÿåˆ¶

```
âœ… èˆŠæ¶æ§‹: å¿…é ˆåŸ·è¡Œå®Œæ•´æµç¨‹
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å³ä½¿æ‰¾åˆ°ç­”æ¡ˆï¼Œä¹Ÿè¦åŸ·è¡Œæ‰€æœ‰æ­¥é©Ÿ   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Pipeline: æ™ºèƒ½æå‰é€€å‡º
   â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”
   â”‚ 1 â”‚â†’â”‚ 2 â”‚â†’â”‚ 3 â”‚â†’ [FAQ åŒ¹é…æˆåŠŸ] â†’ ç«‹å³è¿”å›
   â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜
                          â†‘
                    ç¯€çœ LLM èª¿ç”¨æ™‚é–“
```

### å„ªå‹¢ 4: ç¨ç«‹æ¸¬è©¦

```
âœ… èˆŠæ¶æ§‹: å¿…é ˆæ¸¬è©¦æ•´å€‹å‡½æ•¸
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    æ¸¬è©¦æ•´å€‹ 400+ è¡Œ    â”‚  â† å›°é›£
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Pipeline: æ¸¬è©¦å–®å€‹ç¯€é»
   â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚ç¯€é» 1â”‚  â”‚ç¯€é» 2â”‚  â”‚ç¯€é» 3â”‚  â† æ¯å€‹ç¯€é»ç¨ç«‹æ¸¬è©¦
   â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” 7. å¯¦éš›åŸ·è¡Œè¿½è¹¤è¦–è¦ºåŒ–

### è«‹æ±‚åŸ·è¡Œè¿½è¹¤ï¼ˆJSON æ ¼å¼ï¼‰

```json
{
  "requestId": "req_123456",
  "startTime": 1765110522305,
  "nodes": [
    {
      "node": "validateRequest",
      "status": "success",
      "duration": 5,
      "timestamp": 1765110522310,
      "output": {
        "body": { "message": "ä½ å¥½" },
        "corsHeaders": { ... }
      }
    },
    {
      "node": "initializeServices",
      "status": "success",
      "duration": 120,
      "timestamp": 1765110522430,
      "output": {
        "knowledgeBase": "loaded",
        "llmService": "initialized",
        "contextManager": "ready"
      }
    },
    {
      "node": "contextManagement",
      "status": "success",
      "duration": 2,
      "timestamp": 1765110522432
    },
    {
      "node": "intentExtraction",
      "status": "success",
      "duration": 8,
      "timestamp": 1765110522440,
      "output": {
        "intent": "greeting",
        "entities": {}
      }
    },
    {
      "node": "stateTransition",
      "status": "success",
      "duration": 3,
      "timestamp": 1765110522443,
      "output": {
        "nextState": "INIT"
      }
    },
    {
      "node": "specialIntents",
      "status": "continue",
      "duration": 1,
      "timestamp": 1765110522444
    },
    {
      "node": "faqCheck",
      "status": "continue",
      "duration": 2,
      "timestamp": 1765110522446
    },
    {
      "node": "llmGeneration",
      "status": "success",
      "duration": 1800,
      "timestamp": 1765110524246,
      "output": {
        "reply": "æ‚¨å¥½ï¼å¾ˆé«˜èˆˆç‚ºæ‚¨æœå‹™ï¼..."
      }
    },
    {
      "node": "buildResponse",
      "status": "success",
      "duration": 3,
      "timestamp": 1765110524249
    }
  ],
  "totalDuration": 1944,
  "endTime": 1765110524249
}
```

---

## ğŸ’¡ 8. Pipeline æ¨¡å¼å¸¶ä¾†çš„å¯è¦–åŒ–å¥½è™•ç¸½çµ

### å¥½è™• 1: æ¸…æ™°çš„åŸ·è¡Œæµç¨‹ âœ…

```
æ¯å€‹è«‹æ±‚çš„åŸ·è¡Œè·¯å¾‘ä¸€ç›®äº†ç„¶ï¼š
â€¢ å“ªäº›ç¯€é»åŸ·è¡Œäº†
â€¢ å“ªäº›ç¯€é»è·³éäº†
â€¢ æ¯å€‹ç¯€é»èŠ±äº†å¤šå°‘æ™‚é–“
â€¢ åœ¨å“ªå€‹ç¯€é»æå‰é€€å‡º
```

### å¥½è™• 2: æ˜“æ–¼èª¿è©¦ âœ…

```
å‡ºéŒ¯æ™‚å¯ä»¥ç«‹å³å®šä½ï¼š
â€¢ éŒ¯èª¤ç™¼ç”Ÿåœ¨å“ªå€‹ç¯€é»
â€¢ è©²ç¯€é»çš„è¼¸å…¥æ˜¯ä»€éº¼
â€¢ è©²ç¯€é»çš„è¼¸å‡ºæ˜¯ä»€éº¼
â€¢ åŸ·è¡Œæ™‚é–“æ˜¯å¦ç•°å¸¸
```

### å¥½è™• 3: æ€§èƒ½åˆ†æ âœ…

```
å¯ä»¥è¼•é¬†è­˜åˆ¥æ€§èƒ½ç“¶é ¸ï¼š
â€¢ å“ªå€‹ç¯€é»æœ€æ…¢
â€¢ å“ªäº›ç¯€é»å¯ä»¥å„ªåŒ–
â€¢ æå‰é€€å‡ºç¯€çœäº†å¤šå°‘æ™‚é–“
```

### å¥½è™• 4: å¯è¦–åŒ–ç›£æ§ âœ…

```
å¯ä»¥å‰µå»ºç›£æ§å„€è¡¨æ¿ï¼š
â€¢ å¯¦æ™‚åŸ·è¡Œæµç¨‹åœ–
â€¢ ç¯€é»åŸ·è¡Œçµ±è¨ˆ
â€¢ éŒ¯èª¤ç‡è¿½è¹¤
â€¢ æ€§èƒ½æŒ‡æ¨™ç›£æ§
```

---

## ğŸ› ï¸ 9. å¦‚ä½•åˆ©ç”¨è¦–è¦ºåŒ–å„ªå‹¢

### æ–¹æ¡ˆ A: å‰µå»ºåŸ·è¡Œè¿½è¹¤å·¥å…·

å¯ä»¥å‰µå»ºä¸€å€‹å·¥å…·ä¾†å¯è¦–åŒ– Pipeline åŸ·è¡Œï¼š

```typescript
// å¾ PipelineContext.logs ç”ŸæˆåŸ·è¡Œå ±å‘Š
function generatePipelineReport(ctx: PipelineContext) {
  return {
    flow: ctx.logs.map(log => ({
      node: log.node,
      status: log.level,
      duration: log.duration,
    })),
    totalTime: Date.now() - ctx.startTime,
    performance: {
      slowestNode: findSlowestNode(ctx.logs),
      fastestNode: findFastestNode(ctx.logs),
    }
  };
}
```

### æ–¹æ¡ˆ B: æ—¥èªŒèšåˆå’Œåˆ†æ

å°‡ Pipeline æ—¥èªŒèšåˆåˆ°ç›£æ§ç³»çµ±ï¼š

```
Cloudflare Pages Logs
  â†“
Pipeline Execution Logs
  â†“
åˆ†æå·¥å…· (Grafana/Datadog)
  â†“
å¯è¦–åŒ–å„€è¡¨æ¿
```

### æ–¹æ¡ˆ C: åœ¨éŸ¿æ‡‰ä¸­åŒ…å«åŸ·è¡Œè³‡è¨Šï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰

```typescript
// é–‹ç™¼æ¨¡å¼ï¼šåœ¨éŸ¿æ‡‰ä¸­åŒ…å«åŸ·è¡Œè³‡è¨Š
if (ctx.env.ENVIRONMENT === 'development') {
  response.headers.set('X-Pipeline-Execution', JSON.stringify({
    nodes: ctx.logs,
    totalDuration: Date.now() - ctx.startTime,
  }));
}
```

---

**é€™äº›è¦–è¦ºåŒ–å±•ç¤ºæ¸…æ™°å±•ç¤ºäº† Pipeline æ¨¡å¼çš„å„ªå‹¢ï¼** ğŸ‰

