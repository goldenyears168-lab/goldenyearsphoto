# Functional Specification
## 好時有影 - 專業攝影工作室網站

**版本**: 1.0  
**日期**: 2024-11  
**基於**: PRD v1.0

---

## 目錄 (Table of Contents)

- [2.1 User Stories](#21-user-stories)
  - [導覽與發現](#導覽與發現)
  - [價格與服務資訊](#價格與服務資訊)
  - [作品集瀏覽](#作品集瀏覽)
  - [預約流程](#預約流程)
  - [資訊查詢](#資訊查詢)
- [2.2 Flow Diagrams](#22-flow-diagrams)
  - [Flow 1: 首頁 → 選擇服務 → 查看價目 → 預約](#flow-1-首頁--選擇服務--查看價目--預約)
  - [Flow 2: 直接進入價目表 → 預約](#flow-2-直接進入價目表--預約)
  - [Flow 3: 從作品集頁面 → 預約](#flow-3-從作品集頁面--預約)
  - [Flow 4: 資訊查詢流程](#flow-4-資訊查詢流程)
- [2.3 Data / Field Specifications](#23-data--field-specifications)
  - [價目表頁面資料結構](#價目表頁面資料結構)
  - [作品集項目資料結構](#作品集項目資料結構)
  - [預約頁面資料結構](#預約頁面資料結構)
- [2.4 Business Rules](#24-business-rules)
  - [作品集顯示規則](#作品集顯示規則)
  - [價格顯示規則](#價格顯示規則)
  - [預約流程規則](#預約流程規則)
  - [SEO 規則](#seo-規則)
- [2.5 Edge Cases](#25-edge-cases)
  - [資料缺失處理](#資料缺失處理)
  - [外部服務錯誤](#外部服務錯誤)
  - [裝置與瀏覽器限制](#裝置與瀏覽器限制)
- [2.6 Error Flows](#26-error-flows)
  - [預約流程錯誤處理](#預約流程錯誤處理)
  - [圖片載入錯誤處理](#圖片載入錯誤處理)
  - [資料載入錯誤處理](#資料載入錯誤處理)
- [2.7 System-Level Flow Diagram](#27-system-level-flow-diagram)
  - [整體系統架構流程](#整體系統架構流程)
  - [建置流程](#建置流程)
  - [圖片處理流程](#圖片處理流程)
  - [資料流程](#資料流程)

---

## 2.1 User Stories

### 導覽與發現

**US-001**: 作為訪客，我想要在首頁看到清晰的作品集分類，以便快速找到我需要的服務類型。

**US-002**: 作為訪客，我想要使用篩選器瀏覽不同類型的作品，以便比較不同風格的攝影作品。

**US-003**: 作為訪客，我想要從任何頁面快速導覽到價目表，以便了解服務價格。

**US-004**: 作為訪客，我想要在行動裝置上輕鬆使用導覽選單，以便在手機上瀏覽網站。

---

### 價格與服務資訊

**US-005**: 作為求職者，我想要查看證件照的詳細價格和服務包含項目，以便決定是否預約。

**US-006**: 作為學生，我想要比較不同類型畢業照的價格，以便選擇符合預算的服務。

**US-007**: 作為專業人士，我想要了解形象照的完整服務流程，以便評估是否符合需求。

---

### 作品集瀏覽

**US-008**: 作為訪客，我想要看到高品質的作品範例，以便評估攝影風格是否符合我的期待。

**US-009**: 作為訪客，我想要快速載入作品圖片，以便在行動網路環境下也能順暢瀏覽。

---

### 預約流程

**US-010**: 作為訪客，我想要從首頁直接點擊「立即預約」按鈕，以便快速開始預約流程。

**US-011**: 作為訪客，我想要選擇方便的分店（中山店或公館店），以便選擇最適合的地點。

**US-012**: 作為訪客，我想要了解預約後需要準備什麼，以便提前準備。

---

### 資訊查詢

**US-013**: 作為訪客，我想要閱讀 FAQ 頁面，以便了解常見問題的答案。

**US-014**: 作為訪客，我想要了解工作室的團隊背景，以便建立信任。

**US-015**: 作為訪客，我想要了解拍攝流程，以便知道預約後會發生什麼。

---

## 2.2 Flow Diagrams

### Flow 1: 首頁 → 選擇服務 → 查看價目 → 預約

```
STEP 1: 訪客進入首頁 (/)
  ↓
STEP 2: 瀏覽作品集篩選器，選擇感興趣的類別（例如：韓式證件照）
  ↓
STEP 3: 查看該類別的作品範例
  ↓
IF [訪客想了解更多] → GO TO STEP 4
ELSE IF [訪客已決定預約] → GO TO STEP 6
  ↓
STEP 4: 點擊「查看價目」按鈕，進入價目表頁面 (/price-list/)
  ↓
STEP 5: 查看詳細價格和服務包含項目
  ↓
STEP 6: 點擊「立即預約」或「預約下一個好時刻」按鈕
  ↓
STEP 7: 進入預約選擇頁面 (/booking/)
  ↓
STEP 8: 選擇分店（中山店或公館店）
  ↓
STEP 9: 進入外部預約系統或預約頁面
  ↓
END: 完成預約流程
```

---

### Flow 2: 直接進入價目表 → 預約

```
STEP 1: 訪客直接進入價目表頁面 (/price-list/)
  ↓
STEP 2: 瀏覽不同服務的價格和內容
  ↓
STEP 3: 決定要預約的服務
  ↓
STEP 4: 點擊頁面上的「立即預約」按鈕
  ↓
STEP 5: 進入預約選擇頁面 (/booking/)
  ↓
STEP 6: 選擇分店
  ↓
STEP 7: 進入外部預約系統
  ↓
END: 完成預約
```

---

### Flow 3: 從作品集頁面 → 預約

```
STEP 1: 訪客進入作品集頁面（例如：/blog/graduation/）
  ↓
STEP 2: 瀏覽該類別的作品範例
  ↓
STEP 3: 確認風格符合需求
  ↓
STEP 4: 點擊頁面上的「立即預約」按鈕
  ↓
STEP 5: 進入預約選擇頁面 (/booking/)
  ↓
STEP 6: 選擇分店
  ↓
STEP 7: 進入外部預約系統
  ↓
END: 完成預約
```

---

### Flow 4: 資訊查詢流程

```
STEP 1: 訪客進入任何頁面
  ↓
STEP 2: 點擊導覽選單中的「常見問題」或「關於我們」
  ↓
STEP 3: 閱讀相關資訊
  ↓
IF [訪客決定預約] → GO TO Flow 1, STEP 6
ELSE IF [訪客需要更多資訊] → GO TO STEP 4
  ↓
STEP 4: 繼續瀏覽其他頁面（價目表、作品集等）
  ↓
END: 訪客獲得所需資訊或離開網站
```

---

## 2.3 Data / Field Specifications

### 價目表頁面資料結構

#### 服務項目 (Service Item)
- **名稱** (name): string, required
  - 範例: "韓式證件照", "專業形象照"
- **價格** (price): number, required
  - 格式: 整數（新台幣）
  - 範例: 399, 1500
- **價格單位** (priceUnit): string, optional
  - 預設值: "/張"
  - 範例: "/張", "/組", "/人"
- **服務包含項目** (includes): array of strings, required
  - 每個項目為字串
  - 範例: ["專業自然精修 (可校稿兩次)", "成品為高畫質電子檔"]
- **升級選項** (upgrades): array of objects, optional
  - 每個物件包含:
    - name: string (升級項目名稱)
    - price: number (額外費用)
  - 範例: [{ name: "急件可於隔日交件", price: 100 }]
- **範例圖片** (exampleImages): array of strings, optional
  - 圖片路徑（相對於 assets/images/content/price-list/）
  - 範例: ["ID_Card_Example_1.jpg", "ID_Card_Example_2.jpg"]

---

### 作品集項目資料結構

#### 作品項目 (Portfolio Item)
- **分類** (category): string, required
  - 必須對應篩選器的 data-filter 值
  - 範例: "passport-korea", "linkedin-portrait"
- **圖片路徑** (imagePath): string, required
  - 相對於 portfolio/ 目錄的路徑
  - 範例: "korean-id/korean-id-1.jpg"
- **替代文字** (altText): string, required
  - 用於無障礙和 SEO
  - 範例: "韓式證件照範例 1"

---

### 預約頁面資料結構

#### 分店資訊 (Location)
- **名稱** (name): string, required
  - 範例: "中山店", "公館店"
- **圖片路徑** (imagePath): string, required
  - 相對於 assets/images/content/booking/ 的路徑
  - 範例: "location-1.jpg"
- **描述** (description): string, required
  - 簡短描述，用於卡片內容
  - 範例: "鄰近中山捷運站，交通便利。適合上班族拍攝專業形象照。"
- **預約連結** (bookingUrl): string, required
  - 外部預約系統的 URL 或相對路徑
  - 範例: "/booking/zhongshan/"

---

## 2.4 Business Rules

### 作品集顯示規則

1. **預設顯示類別**
   - 首頁作品集預設顯示「韓式證件照」類別（data-filter="passport-korea"）
   - 這是因為韓式證件照是最受歡迎的服務

2. **篩選器行為**
   - 點擊篩選按鈕時，只顯示該類別的作品
   - 使用 `hidden` 屬性隱藏其他類別（而非 CSS display）
   - URL hash 會更新為 `#filter=category-name`，支援分享和書籤

3. **圖片載入**
   - 所有作品圖片使用 `loading="lazy"` 延遲載入
   - 圖片來源使用 R2 CDN（透過 `r2img` filter）
   - 如果 R2 未設定，回退到本地 assets/images

---

### 價格顯示規則

1. **價格格式**
   - 所有價格以新台幣顯示，不顯示貨幣符號（或顯示 "NT$"）
   - 價格數字使用整數，不顯示小數點
   - 範例: "優惠 $399 /張"

2. **服務包含項目**
   - 每個服務必須明確列出包含的項目
   - 使用無序列表 (`<ul>`) 顯示
   - 重要資訊（如「可校稿兩次」）必須明確標示

3. **升級選項**
   - 升級選項顯示為額外費用
   - 格式: "升級項目名稱 +$價格"
   - 範例: "急件可於隔日交件+$100"

---

### 預約流程規則

1. **分店選擇**
   - 訪客必須先選擇分店（中山店或公館店）
   - 每個分店有獨立的預約頁面
   - 預約頁面可能連結到外部預約系統（如 Calendly、Acuity）

2. **預約按鈕位置**
   - 首頁 Hero section: 「立即預約」按鈕
   - 首頁底部 CTA: 「預約下一個好時刻」按鈕
   - 價目表頁面: 每個服務卡片應有預約連結（如適用）
   - 導覽選單: 「預約」連結

---

### SEO 規則

1. **頁面 Title**
   - 格式: "頁面標題｜好時有影 - 簡短描述"
   - 範例: "服務價目表｜好時有影 - 韓式證件照、形象照"

2. **Meta Description**
   - 每個頁面必須有獨立的 meta description
   - 長度: 120-160 字元
   - 包含關鍵字和行動呼籲

3. **圖片 Alt Text**
   - 所有圖片必須有描述性的 alt 文字
   - 格式: "服務類型 + 範例 + 編號"
   - 範例: "韓式證件照範例 1"

---

## 2.5 Edge Cases

### 資料缺失處理

1. **作品圖片缺失**
   - 如果 R2 CDN 圖片載入失敗，顯示預設的「圖片載入中」佔位符
   - 如果本地圖片檔案不存在，在開發環境顯示警告，生產環境不顯示該作品項目

2. **價目表資料缺失**
   - 如果某個服務的價格資料缺失，該服務卡片不顯示價格，顯示「請聯繫我們」訊息

3. **分店資訊缺失**
   - 如果分店圖片缺失，使用預設的佔位圖片
   - 如果預約連結缺失，按鈕顯示為「即將開放」並禁用

---

### 外部服務錯誤

1. **R2 CDN 無法連接**
   - 系統自動回退到本地 assets/images 目錄
   - 使用 `r2img` filter 的 fallback 機制

2. **外部預約系統錯誤**
   - 如果預約系統無法載入（iframe 或外部連結），顯示錯誤訊息
   - 提供替代聯繫方式（電話、Email、Facebook Messenger）

3. **網路連線緩慢**
   - 圖片使用 lazy loading，不影響首屏載入
   - 顯示載入狀態（skeleton screen 或 spinner）

---

### 裝置與瀏覽器限制

1. **非常小的螢幕 (< 320px)**
   - 確保所有內容仍可讀取
   - 導覽選單改為全螢幕覆蓋
   - 圖片使用 `object-fit: cover` 保持比例

2. **舊版瀏覽器 (IE11, 舊版 Safari)**
   - 使用 CSS 和 JS polyfill（如適用）
   - 確保核心功能（導覽、預約連結）仍可運作
   - 進階動畫在不支援的瀏覽器中自動停用

3. **JavaScript 停用**
   - 篩選器功能無法使用，但所有作品仍顯示
   - 導覽選單在行動裝置上可能無法展開（需提供 CSS-only 解決方案）

---

## 2.6 Error Flows

### 預約流程錯誤處理

**錯誤情況 1: 外部預約系統無法載入**
- **觸發條件**: iframe 載入失敗或超時（> 10 秒）
- **系統回應**:
  1. 顯示錯誤訊息：「預約系統暫時無法使用，請稍後再試或聯繫我們」
  2. 提供替代聯繫方式：
     - 電話號碼（如適用）
     - Email 地址
     - Facebook Messenger 連結
  3. 記錄錯誤到控制台（開發環境）或錯誤追蹤系統（生產環境）

---

**錯誤情況 2: 分店選擇頁面載入失敗**
- **觸發條件**: 頁面資源（CSS、JS）載入失敗
- **系統回應**:
  1. 顯示基本 HTML 內容（無樣式）
  2. 確保連結仍可點擊
  3. 提供「返回首頁」連結

---

### 圖片載入錯誤處理

**錯誤情況 3: 作品圖片載入失敗**
- **觸發條件**: 圖片 HTTP 請求失敗（404、500、網路錯誤）
- **系統回應**:
  1. 顯示預設的佔位圖片或「圖片載入中」訊息
  2. 不影響其他作品的顯示
  3. 在開發環境記錄錯誤到控制台

---

### 資料載入錯誤處理

**錯誤情況 4: 價目表資料檔案損壞或格式錯誤**
- **觸發條件**: JSON/YAML 資料檔案無法解析
- **系統回應**:
  1. 顯示錯誤訊息：「價目表暫時無法顯示，請聯繫我們」
  2. 提供聯繫方式
  3. 記錄錯誤到錯誤追蹤系統

---

## 2.7 System-Level Flow Diagram

### 整體系統架構流程

```
[使用者瀏覽器]
    ↓
[靜態網站 (Eleventy 生成)]
    ├─→ [HTML 頁面]
    ├─→ [CSS (SCSS 編譯)]
    ├─→ [JavaScript (Vanilla JS)]
    └─→ [靜態資源 (圖片、字體)]
         ↓
    [Cloudflare R2 CDN] ← 圖片儲存與分發
         ↓
[外部預約系統] ← 預約流程（Calendly / Acuity / 其他）
    ↓
[完成預約]
```

---

### 建置流程

```
[開發環境]
    ↓
[Eleventy 建置]
    ├─→ 編譯 Nunjucks 模板
    ├─→ 編譯 SCSS → CSS
    ├─→ 處理圖片（壓縮、上傳 R2）
    └─→ 生成靜態 HTML
         ↓
[_site/ 目錄] (建置輸出)
    ↓
[部署到託管服務]
    ├─→ Netlify / Vercel / Cloudflare Pages
    └─→ CDN 分發
         ↓
[生產環境網站]
```

---

### 圖片處理流程

```
[原始圖片 (images-original/)]
    ↓
[compress-images.mjs 腳本]
    ├─→ 讀取原始圖片
    ├─→ 使用 Sharp 壓縮
    └─→ 輸出到 images/ 目錄
         ↓
[images/ 目錄] (壓縮後圖片)
    ↓
[upload-portfolio-to-r2.mjs 腳本]
    ├─→ 讀取壓縮後圖片
    ├─→ 再次優化（1200px 寬度，80% 品質）
    └─→ 上傳到 Cloudflare R2
         ↓
[Cloudflare R2 CDN]
    ↓
[網站使用 r2img filter]
    └─→ 生成 R2 CDN URL 或本地 fallback
```

---

### 資料流程

```
[模板檔案 (.njk)]
    ↓
[Eleventy 處理]
    ├─→ 讀取 _data/metadata.json
    ├─→ 讀取 front matter (YAML)
    ├─→ 處理 Nunjucks 模板
    └─→ 應用 filters (r2img, dateToISO, inlineCSS)
         ↓
[生成的 HTML]
    ├─→ 內嵌 CSS (inlineCSS filter)
    ├─→ 圖片 URL (r2img filter)
    └─→ 完整的靜態 HTML
```

---

**文件維護者**: 開發團隊  
**最後更新**: 2024-11

