@layer layout {

  /* [ V9.0 ] ç€è¦½å™¨æ‡‰è‡ªå‹•è™•ç† [hidden]ï¼Œä½†å¯åŠ ä¸€å±¤ä¿éšª */
  /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
  [hidden] {
    display: none !important;
  }

  /* [ ğŸš€ V10.0 è£œå¼· ] é–å®šæ»¾å‹• */
  html.nav-open { 
    overflow: hidden; 
  }

  /* --- 1. Header åŸºç¤çµæ§‹ (Mobile & Desktop å…±é€š) --- */
  .global-header {
    background-color: var(--color-surface-card); /* æŸ”ç™½èƒŒæ™¯ */
    background-image: var(--texture-paper); /* æ·¡æ·¡ç´™ç´‹ç´‹ç† */
    background-size: cover; /* è¦†è“‹æ•´å€‹ header */
    background-position: center;
    background-repeat: no-repeat;
    background-blend-mode: overlay; /* æ·¡æ·¡æ··åˆï¼Œä¸æ˜é¡¯ */
    border-bottom: 1px solid var(--color-border-subtle); /* æ¥µæ·¡çš„è¤è‰²é‚Šæ¡† */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: var(--header-h); 
    z-index: var(--z-index-header);
    display: flex;
    align-items: center;
    margin: 0;
  }

  .global-header nav {
    display: flex;
    align-items: center;
    width: 100%;
    gap: 20px;
  }

  .header-navigation-wrapper {
    flex: 1 1 auto;
    min-width: 0;
  }

  .header-logo {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .header-logo img {
    height: 40px !important; 
    width: 40px !important;  
    max-width: 100%;
  }

  /* --- 2. è¡Œå‹•ç‰ˆå°èˆª (Mobile-First Default) --- */
  .mobile-nav-toggle {
    display: block;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--color-text-heading); /* æ·±è¤æ–‡å­— */
    margin-left: auto; 
    flex-shrink: 0;
  }

  .header-cta {
    display: none;
  }

  .header-nav {
    display: none; 
  }


  /* --- 3. [ V18.0 ] å…¨åŸŸæŒ‰éˆ•é‡ç½® --- */
  .global-header .nav-dropdown-trigger {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
    padding: 0;
    font: inherit;
    line-height: inherit;
    color: var(--nav-link, #353242);
    background: transparent;
    border: 0;
    border-radius: 0;
    box-shadow: none;
    cursor: pointer;
    text-align: left;
    display: inline-block;
  }
  
  .header-nav > li {
    display: flex;
    align-items: center;
  }


  /* Underline animation for navigation links */
  .header-nav > li > a {
    position: relative;
    /* Remove default underline to use custom animated underline */
    text-decoration: none;
    
    /* Animated underline using ::after pseudo-element */
    &::after {
      content: '';
      position: absolute;
      bottom: -0.35rem;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--color-brand-primary);
      transition: width var(--transition-smooth);
      /* Ensure smooth animation and GPU acceleration */
      will-change: width;
      transform: translateZ(0);
    }
    
    /* Hover and active states: expand underline */
    &:hover::after,
    &:focus-visible::after,
    &.active::after {
      width: 100%;
    }
  }

  /* é ‚å±¤é¸å–®çš„ Hover / Focus æ•ˆæœ */
  .header-nav > li > a:hover,
  .header-nav > li > a:focus-visible,
  .header-nav > li > a.active {
    color: var(--nav-link-hover);
    /* Remove default underline - using animated underline instead */
    text-decoration: none;
  }
  
  .dropdown:hover > .nav-dropdown-trigger,
  .nav-dropdown-trigger:focus-visible,
  .nav-dropdown-trigger[aria-expanded="true"],
  .header-cta:hover,
  .header-cta:focus-visible {
    color: var(--nav-link-hover);
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  /* çµ±ä¸€çš„ Focus æ¨£å¼ */
  .header-nav a:focus-visible,
  .nav-dropdown-trigger:focus-visible,
  .header-cta:focus-visible,
  .mobile-nav-toggle:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* --- 4. è¡Œå‹•ç‰ˆ L1 é¸å–®é–‹å•Ÿç‹€æ…‹ (Mobile State: .is-open) --- */
  .header-nav.is-open {
    display: block;
    position: absolute;
    top: var(--header-h); 
    left: 0;
    right: 0;
    width: 100%;
    background-color: var(--color-surface-card); /* æŸ”ç™½èƒŒæ™¯ */
    background-image: var(--texture-paper); /* æ·¡æ·¡ç´™ç´‹ç´‹ç† */
    background-size: cover; /* è¦†è“‹æ•´å€‹ nav */
    background-position: center;
    background-repeat: no-repeat;
    background-blend-mode: overlay; /* æ·¡æ·¡æ··åˆï¼Œä¸æ˜é¡¯ */
    border-top: 1px solid var(--color-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    z-index: var(--z-index-header-nav); 
    max-height: calc(100vh - var(--header-h));
    overflow-y: auto;
    padding-bottom: 20px; 
    list-style: none;
    margin: 0;
    padding-left: 0; 
  }

  .header-nav.is-open > li > a:hover,
  .header-nav.is-open > li > .nav-dropdown-trigger:hover {
    background-color: #f0f0f0;
  }
  
  .header-cta-mobile {
    display: list-item !important;
    border-bottom: none !important;
    padding: 0; 
  }
  

  /* --- 5. [ V18.0 ] RWD éŸ¿æ‡‰å¼æ¨£å¼é‡æ§‹ --- */

  /* ===== 5.1) æ‰‹æ©Ÿç‰ˆï¼šæ¢ç›®èˆ‡ CTA å…¨éƒ¨å·¦é½Š (V18.0) ===== */
  @media (max-width: 992px) {
    .global-header .header-nav { 
      margin: 0; 
      padding: 0; 
      list-style: none; 
    }
    .global-header .header-nav > li { 
      border-bottom: 1px solid var(--color-border, #eee); 
      padding: 0; 
    }
    
    .global-header .header-nav a,
    .global-header .nav-dropdown-trigger {
      display: block;
      width: 100%;
      text-align: left;
      padding: 16px 24px;
      text-decoration: none;
      color: var(--nav-link);
    }

    .global-header .header-nav .header-cta-mobile > a {
      display: block;
      width: 100%;
      max-width: none;
      margin: 0;                 
      padding: 16px 24px;        
      background: transparent;   
      color: var(--nav-link); 
      border: 0;
      border-radius: 0;          
      box-shadow: none;          
      text-align: left;          
      font-weight: 600; 
      text-decoration: none; 
    }
    
    .global-header .header-nav .header-cta-mobile {
      border-bottom: 1px solid var(--color-border, #eee);
    }
    
    .global-header .header-cta-mobile a:hover {
        background: #f0f0f0;
    }

    /* === [ V18.0 ] è¡Œå‹•ç‰ˆ L2 === */
    .global-header .dropdown-menu,
    .global-header .megamenu-container {
      position: static;
      width: 100%;
      margin: 0;
      padding: 0;
      box-shadow: none;
      background-color: var(--mega-bg, var(--color-surface-card)); /* æŸ”ç™½èƒŒæ™¯ */
      background-image: var(--texture-paper); /* æ·¡æ·¡ç´™ç´‹ç´‹ç† */
      background-size: cover; /* è¦†è“‹æ•´å€‹é¸å–® */
      background-position: center;
      background-repeat: no-repeat;
      background-blend-mode: overlay; /* æ·¡æ·¡æ··åˆï¼Œä¸æ˜é¡¯ */ 
      border-top: 1px solid var(--color-border, #eee); 
      border-bottom: none; 
      padding-left: 0; 
    }
  
    .global-header .dropdown-menu ul,
    .global-header .megamenu-container ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
  
    .global-header .dropdown-menu li,
    .global-header .megamenu-container li {
      border-bottom: 1px solid var(--color-border, #eee);  
    }
    
    .global-header .dropdown-menu a,
    .global-header .megamenu-container a {
      display: block;
      padding: 16px 32px;              
      text-align: left;
      color: var(--mega-link, inherit);
      text-decoration: none;
      border-bottom: none; 
    }
    
    .global-header .dropdown-menu li:last-child,
    .global-header .megamenu-container li:last-child {
        border-bottom: none; 
    }
  
    .global-header .dropdown-menu,
    .global-header .megamenu-container {
      border-left: none;
      border-right: none;
    }
  }


  /* ===== 5.2) æ¡Œé¢ç‰ˆï¼š(V18.0 / V22.0 ä¿®å¾©) ===== */
  @media (min-width: 993px) {
    
    .header-navigation-wrapper {
      display: flex;
      align-items: center;
      gap: 25px; 
      margin-left: auto;
      margin-right: auto;
      flex: 0 1 auto; 
      min-width: auto;
    }
    
    .mobile-nav-toggle { display: none; }
    .header-cta { 
      display: inline-flex; 
      align-items: center; 
      color: var(--nav-cta-text);
      background: var(--nav-cta-bg);
    }
    .header-cta-mobile { display: none !important; }
    
    .header-nav,
    .header-nav.is-open {
      display: flex !important;
      align-items: center;
      gap: 25px; 
      position: static;
      border-top: none;
      box-shadow: none;
      max-height: none;
      overflow: visible;
      background: none;
      width: auto;
      padding-bottom: 0; 
    }

    .global-header .header-nav > li { 
      border: 0; 
      display: flex; 
      align-items: center; 
    }
    
    .global-header .header-nav a,
    .global-header .nav-dropdown-trigger {
      display: inline-block;
      padding: 0; 
      vertical-align: middle;
      text-decoration: none;
      width: auto; 
      border-bottom: none; 
      color: var(--nav-link);
    }
    
    .header-nav > li > a:hover,
    .header-nav > li > .nav-dropdown-trigger:hover {
      background: none; 
      color: var(--nav-link-hover);
      /* Animated underline is handled by ::after pseudo-element */
      text-decoration: none;
    }

    .dropdown {
      position: relative;
    }

    /*
     * =========================================
     * [!!] V22.0 è®Šæ›´ (ä¿®å¾©æ‡¸åœéš§é“)
     * 1. ç§»é™¤ 'display: none'
     * 2. ä¾è³´ 'visibility' å’Œ 'opacity'
     * =========================================
     */
    .dropdown-menu {
      /* [V22.0] ç§»é™¤ display: none; */
      position: absolute;
      top: calc(100% + 8px); /* è£½é€  8px ç©ºéš™ */
      left: 10%;
      z-index: var(--z-index-dropdown); 
      width: max-content;
      min-width: 260px;
      padding: 16px 24px;
      background-color: var(--mega-bg, var(--color-surface-card)); /* æŸ”ç™½èƒŒæ™¯ */
      background-image: var(--texture-paper); /* æ·¡æ·¡ç´™ç´‹ç´‹ç† */
      background-size: cover; /* è¦†è“‹æ•´å€‹é¸å–® */
      background-position: center;
      background-repeat: no-repeat;
      background-blend-mode: overlay; /* æ·¡æ·¡æ··åˆï¼Œä¸æ˜é¡¯ */
      border: 1px solid var(--mega-border, #eee);
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border-radius: 10px;

      /* [V22.0] åˆå§‹ç‹€æ…‹ï¼šéš±è— */
      opacity: 0;
      visibility: hidden;
      transform: translate(-10%, -10px); /* Xå±…ä¸­, Yä¸Šç§» (æº–å‚™è½ä¸‹) */
      
      /* [V22.0] æ‡¸åœéš§é“ (A) - éš±è—æ™‚å»¶é² visibility */
      transition: visibility 0s 0.2s,  
                  opacity 0.2s ease,
                  transform 0.2s ease;
    }
    
    /* [V22.0] é—œéµï¼š
     * è¦†è“‹ L6 çš„ [hidden] { display: none !important; }
     * ç¢ºä¿ JS éš±è—çš„é¸å–®åœ¨æ¡Œé¢ç‰ˆä»å¯è¢« :hover è§¸ç™¼
     */
    .dropdown-menu[hidden] {
        display: block !important; 
        /* ä¿æŒéš±è—ç‹€æ…‹ï¼Œç›´åˆ° :hover */
        opacity: 0;
        visibility: hidden;
    }

    /* [V22.0] çµ±ä¸€ Megamenu å…§é€£çµæ¨£å¼ */
    .dropdown-menu li + li {
      margin-top: 12px;
    }
    .dropdown-menu a {
      display: block; 
      padding: 0; 
      white-space: nowrap; 
      color: var(--mega-link);
      border-radius: 0;
      border-bottom: none; 
      text-decoration: none;
    }
    .dropdown-menu a:hover {
      color: var(--mega-link-hover);
      background: var(--mega-hover-bg, transparent);
      text-decoration: underline;
    }

    /* [V22.0] :hover ç‹€æ…‹ (ç§»é™¤ display: block) */
    .dropdown:hover > .dropdown-menu {
      /* [V22.0] ç§»é™¤ display: block !important; */
      opacity: 1;
      visibility: visible;
      transform: translate(-10%, 0); /* Xå±…ä¸­, Yæ­¸ä½ */
      
      /* [V22.0] æ‡¸åœéš§é“ (B) - é¡¯ç¤ºæ™‚é‡è¨­å»¶é² */
      transition-delay: 0s;
    }


  } /* çµæŸ @media (min-width: 993px) */

  /* === [ V20.0 æ¢å¾© V17.0 ç­–ç•¥æ€§è¦†å¯« ] === */
  .global-header {
    .header-nav a,
    .header-nav .nav-dropdown-trigger,
    .header-cta,
    .header-cta-mobile a,
    .dropdown-menu a,
    .megamenu-container a {
      color: var(--nav-link, #353242) !important;
    }

    .header-nav a:hover,
    .header-nav a:focus-visible, 
    .nav-dropdown-trigger:hover,
    .nav-dropdown-trigger:focus-visible, 
    .dropdown-menu a:hover,
    .megamenu-container a:hover {
      color: var(--nav-link-hover, #353242) !important;
      background-color: var(--mega-hover-bg, transparent) !important; 
    }

    /* Top-level nav links use animated underline, not text-decoration */
    .header-nav > li > a:hover,
    .header-nav > li > a:focus-visible {
      text-decoration: none !important;
    }

    /* [V22.0] ä¿®æ­£ï¼šåƒ… L2 é€£çµåœ¨ hover æ™‚æœ‰ underline */
    .dropdown-menu a:hover,
    .megamenu-container a:hover {
        text-decoration: underline;
    }

    /* active ç‹€æ…‹ä¸€ä½µé‡ç½® */
    .header-nav .active > a,
    .header-nav a.active,
    .dropdown-menu .active > a,
    .megamenu-container .active > a {
      color: var(--nav-link-active, #353242) !important;
    }
  }

} /* çµæŸ @layer layout */