@layer layout {

  /* [ V9.0 ] ç€è¦½å™¨æ‡‰è‡ªå‹•è™•ç† [hidden]ï¼Œä½†å¯åŠ ä¸€å±¤ä¿éšª */
  /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
  [hidden] {
    display: none !important;
  }

  /* [ ğŸš€ V10.0 è£œå¼· ] é–å®šæ»¾å‹• */
  html.nav-open { 
    overflow: hidden; 
  }

  /* --- 1. Header åŸºç¤çµæ§‹ (Mobile & Desktop å…±é€š) --- */
  .global-header {
    background: var(--color-white);
    border-bottom: 1px solid var(--color-border);
    /* [ ğŸš€ V19.0 å‡ç´š ] æ”¹ç‚º position: fixed */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: var(--header-h); /* [V19.0] å›ºå®šä½ˆå±€éœ€è¦æ˜ç¢ºé«˜åº¦ */
    z-index: var(--z-index-header);
    display: flex;
    align-items: center;
    margin: 0; /* [V19.0] ç¢ºä¿ç§»é™¤ body é‚Šè·å½±éŸ¿ */
  }

  .global-header nav {
    display: flex;
    align-items: center;
    width: 100%;
    gap: 20px;
  }

  .header-navigation-wrapper {
    flex: 1 1 auto;
    min-width: 0;
  }

  .header-logo {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .header-logo img {
    height: 40px !important; /* [V18.0] ä¿ç•™ï¼šæ­¤ç‚ºè¦†è“‹ Nunjucks {% image %} å…§è¯æ¨£å¼æ‰€éœ€ */
    width: 40px !important;  /* [V18.0] ä¿ç•™ï¼šåŒä¸Š */
    max-width: 100%;
  }

  /* --- 2. è¡Œå‹•ç‰ˆå°èˆª (Mobile-First Default) --- */
  .mobile-nav-toggle {
    display: block;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--color-dark);
    margin-left: auto; 
    flex-shrink: 0;
  }

  .header-cta {
    display: none;
  }

  .header-nav {
    display: none; 
  }


  /* --- 3. [ V18.0 ] å…¨åŸŸæŒ‰éˆ•é‡ç½® (ç§»é™¤ !important) --- */
  /*
   * V18.0 é‡æ§‹ï¼š
   * ç§»é™¤ V13.0 çš„ !importantã€‚
   * æˆ‘å€‘ä¾è³´ V15.0 çš„ Token (--nav-link) ä¾†è¨­å®šé¡è‰²ã€‚
   */
  .global-header .nav-dropdown-trigger {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
    padding: 0;                 /* ç”±ä¸‹æ–¹ RWD å€å¡Šå„è‡ªè³¦å€¼ */
    font: inherit;
    line-height: inherit;
    color: var(--nav-link, #353242); /* [V18.0] ç›´æ¥ä½¿ç”¨ Token */
    background: transparent;
    border: 0;
    border-radius: 0;
    box-shadow: none;
    cursor: pointer;
    text-align: left;
    display: inline-block; /* æ¡Œé¢ç‰ˆåŸºç¤ */
  }
  
  .header-nav > li {
    display: flex;
    align-items: center;
  }


  /* é ‚å±¤é¸å–®çš„ Hover / Focus æ•ˆæœ */
  /* [V18.0] ç§»é™¤ !importantï¼Œä¾è³´ V15.0 Token */
  .header-nav > li > a:hover,
  .header-nav > li > a:focus-visible,
  .header-nav > li > a.active,
  .dropdown:hover > .nav-dropdown-trigger,
  .nav-dropdown-trigger:focus-visible,
  .nav-dropdown-trigger[aria-expanded="true"],
  .header-cta:hover,
  .header-cta:focus-visible {
    color: var(--nav-link-hover);
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  /* çµ±ä¸€çš„ Focus æ¨£å¼ */
  .header-nav a:focus-visible,
  .nav-dropdown-trigger:focus-visible,
  .header-cta:focus-visible,
  .mobile-nav-toggle:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* --- 4. è¡Œå‹•ç‰ˆ L1 é¸å–®é–‹å•Ÿç‹€æ…‹ (Mobile State: .is-open) --- */
  .header-nav.is-open {
    display: block;
    position: absolute;
    top: var(--header-h); 
    left: 0;
    right: 0;
    width: 100%;
    background: var(--color-white);
    border-top: 1px solid var(--color-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    z-index: var(--z-index-header-nav); 
    max-height: calc(100vh - var(--header-h));
    overflow-y: auto;
    padding-bottom: 20px; 
    list-style: none;
    margin: 0;
    padding-left: 0; 
  }

  .header-nav.is-open > li > a:hover,
  .header-nav.is-open > li > .nav-dropdown-trigger:hover {
    background-color: #f0f0f0;
  }
  
  /* [V16.0 ç§»é™¤] (ä¿æŒç§»é™¤) */

  /* [V9.0] è¡Œå‹•ç‰ˆ CTA æ¨£å¼ (åœ¨ <li> å…§) */
  .header-cta-mobile {
    display: list-item !important; /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
    border-bottom: none !important; /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
    padding: 0; 
  }
  

  /* --- 5. [ V18.0 ] RWD éŸ¿æ‡‰å¼æ¨£å¼é‡æ§‹ --- */

  /* ===== 5.1) æ‰‹æ©Ÿç‰ˆï¼šæ¢ç›®èˆ‡ CTA å…¨éƒ¨å·¦é½Š (V18.0) ===== */
  @media (max-width: 992px) {
    /* [V18.0] ç§»é™¤ V14.0 çš„ !important */
    .global-header .header-nav { 
      margin: 0; 
      padding: 0; 
      list-style: none; 
    }
    .global-header .header-nav > li { 
      border-bottom: 1px solid var(--color-border, #eee); 
      padding: 0; 
    }
    
    /* [V13.0] çµ±ä¸€ <a> å’Œ <button> æ¨£å¼ */
    .global-header .header-nav a,
    .global-header .nav-dropdown-trigger {
      display: block;
      width: 100%;
      text-align: left;
      padding: 16px 24px;
      text-decoration: none;
      color: var(--nav-link); /* [V18.0] */
    }

    /* [V18.0] è®“ã€Œç·šä¸Šé ç´„ã€è·Ÿæ¸…å–®æ¢ç›®å®Œå…¨é½Šå¹³ï¼ˆç§»é™¤ !importantï¼‰ */
    .global-header .header-nav .header-cta-mobile > a {
      display: block;
      width: 100%;
      max-width: none;
      margin: 0;                 
      padding: 16px 24px;        
      background: transparent;   
      color: var(--nav-link); 
      border: 0;
      border-radius: 0;          
      box-shadow: none;          
      text-align: left;          
      font-weight: 600; 
      text-decoration: none; 
    }
    
    /* [V14.0] è¦–è¦ºä¸€è‡´ï¼šåŠ ä¸Šèˆ‡å…¶ä»– LI ç›¸åŒçš„åˆ†éš”ç·š */
    .global-header .header-nav .header-cta-mobile {
      border-bottom: 1px solid var(--color-border, #eee);
    }
    
    .global-header .header-cta-mobile a:hover {
        background: #f0f0f0;
    }

    /* === [ V18.0 ] è¡Œå‹•ç‰ˆ L2 (ç§»é™¤ !important) === */
    .global-header .dropdown-menu,
    .global-header .megamenu-container {
      position: static;     /* [V18.0] */
      width: 100%;
      margin: 0;
      padding: 0;
      box-shadow: none;
      background: var(--mega-bg, #fff); 
      border-top: 1px solid var(--color-border, #eee); 
      border-bottom: none; 
      padding-left: 0; 
    }
  
    .global-header .dropdown-menu ul,
    .global-header .megamenu-container ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
  
    .global-header .dropdown-menu li,
    .global-header .megamenu-container li {
      border-bottom: 1px solid var(--color-border, #eee);  
    }
    
    .global-header .dropdown-menu a,
    .global-header .megamenu-container a {
      display: block;
      padding: 16px 32px;              
      text-align: left;
      color: var(--mega-link, inherit);
      text-decoration: none;
      border-bottom: none; 
    }
    
    .global-header .dropdown-menu li:last-child,
    .global-header .megamenu-container li:last-child {
        border-bottom: none; 
    }
  
    .global-header .dropdown-menu,
    .global-header .megamenu-container {
      border-left: none;
      border-right: none;
    }
    /* === [ V16.0 çµæŸ ] === */

  }


  /* ===== 5.2) æ¡Œé¢ç‰ˆï¼š(V18.0) ===== */
  @media (min-width: 993px) {
    
    .header-navigation-wrapper {
      display: flex;
      align-items: center;
      gap: 25px; 
      margin-left: auto;
      margin-right: auto;
      flex: 0 1 auto; 
      min-width: auto;
    }
    
    .mobile-nav-toggle { display: none; }
    .header-cta { 
      display: inline-flex; 
      align-items: center; 
      color: var(--nav-cta-text); /* [V18.0] */
      background: var(--nav-cta-bg); /* [V18.0] */
      /* (æ­¤è™•æ‡‰æœ‰ padding, border-radius ç­‰ï¼Œç¹¼æ‰¿è‡ªä½ˆæ™¯ä¸»é¡Œ) */
    }
    .header-cta-mobile { display: none !important; } /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
    
    .header-nav,
    .header-nav.is-open {
      display: flex !important; /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
      align-items: center;
      gap: 25px; 
      position: static;
      border-top: none;
      box-shadow: none;
      max-height: none;
      overflow: visible;
      background: none;
      width: auto;
      padding-bottom: 0; 
    }

    .global-header .header-nav > li { 
      border: 0; 
      display: flex; 
      align-items: center; 
    }
    
    .global-header .header-nav a,
    .global-header .nav-dropdown-trigger {
      display: inline-block;
      padding: 0; 
      vertical-align: middle;
      text-decoration: none;
      width: auto; 
      border-bottom: none; 
      color: var(--nav-link); /* [V18.0] */
    }
    
    .header-nav > li > a:hover,
    .header-nav > li > .nav-dropdown-trigger:hover {
      background: none; 
      color: var(--nav-link-hover); /* [V18.0] */
    }

    .dropdown {
      position: relative;
    }

    .dropdown-menu {
      display: none; 
      position: absolute;
      top: 100%;
      left: 0;
      z-index: var(--z-index-dropdown); 
      width: max-content;
      min-width: 200px; 
      padding: 10px;
      background: var(--mega-bg);
      border: 1px solid var(--mega-border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
    }

    .dropdown-menu a {
      display: block; padding: 10px 15px;
      white-space: nowrap; color: var(--mega-link);
      border-radius: 6px; border-bottom: none; 
    }

    .dropdown-menu a:hover {
      color: var(--mega-link-hover);
      background: var(--mega-hover-bg);
      text-decoration: none;
    }

    .dropdown:hover > .dropdown-menu {
      display: block !important; /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    /* [V9.0] ç¢ºä¿ JS çš„ [hidden] åœ¨æ¡Œé¢ç‰ˆè¢« :hover è¦†è“‹ */
    .dropdown-menu[hidden] {
        display: none;
    }
    .dropdown:hover > .dropdown-menu[hidden] {
        display: block !important; /* [V18.0] ä¿ç•™ï¼šåŠŸèƒ½æ€§è¦†å¯« */
    }


  } /* çµæŸ @media (min-width: 993px) */

  /* === [ V20.0 æ¢å¾© V17.0 ç­–ç•¥æ€§è¦†å¯« ] === */
  /* * V20.0 ä¿®å¾©ï¼š
   * 1. æ¢å¾© V17.0 çš„å¼·åˆ¶è¦†å¯«ï¼Œè§£æ±º V18.0 ç§»é™¤ !important å¾Œï¼Œ
   * <a> æ¨™ç±¤è¢«å…¨åŸŸæ¨£å¼æ±¡æŸ“çš„å•é¡Œ (é¡¯ç¤ºç‚ºæ·¡é‡‘è‰²)ã€‚
   * 2. ç¢ºä¿ <a> å’Œ <button> éƒ½èƒ½æ­£ç¢ºä½¿ç”¨ V15.0 çš„ Tokenã€‚
   */
  .global-header {
    /* æ‰€æœ‰é€£çµã€æŒ‰éˆ•ã€æ¬¡é¸å–®ã€CTA éƒ½ä½¿ç”¨ V15.0 çš„ Token */
    .header-nav a,
    .header-nav .nav-dropdown-trigger,
    .header-cta,
    .header-cta-mobile a,
    .dropdown-menu a,
    .megamenu-container a {
      /* [V20.0] ä½¿ç”¨ V15.0 Token + å¼·åˆ¶è¦†å¯« */
      color: var(--nav-link, #353242) !important;
    }

    /* æ»‘éæˆ– focus æ™‚ä¹Ÿä¿æŒ V15.0 çš„ Token */
    .header-nav a:hover,
    .header-nav a:focus-visible, /* [V20.0] ä¿®æ­£ç‚º focus-visible */
    .nav-dropdown-trigger:hover,
    .nav-dropdown-trigger:focus-visible, /* [V20.0] ä¿®æ­£ç‚º focus-visible */
    .dropdown-menu a:hover,
    .megamenu-container a:hover {
      color: var(--nav-link-hover, #353242) !important;
      background-color: var(--mega-hover-bg, #f7f7f7); 
    }

    /* active ç‹€æ…‹ä¸€ä½µé‡ç½® */
    .header-nav .active > a,
    .header-nav a.active,
    .dropdown-menu .active > a,
    .megamenu-container .active > a {
      color: var(--nav-link-active, #353242) !important;
    }
  }

} /* çµæŸ @layer layout */

/* ========= Desktopï¼šè®“ã€Œæ‹æ”æŒ‡å—ã€çš„ dropdown è·Ÿ megamenu çµ±ä¸€é¢¨æ ¼ ========= */
@media (min-width: 993px) {
  .global-header .dropdown--guide {
    position: relative;
  }

  .global-header .dropdown--guide .dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);       /* è·Ÿ header æœ‰ä¸€é»è·é›¢ï¼Œå’Œ megamenu å°é½Š */
    left: 50%;
    transform: translateX(-50%); /* ä»¥ã€Œæ‹æ”æŒ‡å—ã€å±…ä¸­å°é½Š */
    min-width: 260px;            /* çµ¦ä¸€å€‹ç©©å®šå¯¬åº¦ï¼Œä¸æœƒå¤ªçª„ */
    padding: 16px 24px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    border: 1px solid #eee;
    z-index: var(--z-index-dropdown, 1002);
  }

  /* å…§éƒ¨æ¯å€‹é …ç›®é–“è·ï¼Œæ’ç‰ˆè·Ÿ megamenu é¡ä¼¼ */
  .global-header .dropdown--guide .dropdown-menu li + li {
    margin-top: 12px;
  }

  .global-header .dropdown--guide .dropdown-menu a {
    display: block;
    padding: 0;
    text-decoration: none;
    color: #000;
  }

  .global-header .dropdown--guide .dropdown-menu a:hover,
  .global-header .dropdown--guide .dropdown-menu a:focus {
    color: #000;
    text-decoration: underline;
  }
}
