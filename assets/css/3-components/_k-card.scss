/* ==================================================
 * Card Component - "Warm × Enterprise" Design System
 * 
 * Unified card system for all card-like UI blocks:
 * - Service/price cards
 * - Team member cards
 * - Testimonials
 * - Booking/store cards
 * 
 * Uses design tokens for consistent visual language.
 * ==================================================
 */

@layer components {
  
  /* ============================================
   * Base Card
   * ============================================ */
  
  .card {
    display: flex;
    flex-direction: column;

    /* Paper Texture (紙張質感) - Warm Humanism Mode - 淡淡紋理 */
    background-color: var(--color-surface-card); /* 柔白卡片背景 */
    background-image: var(--texture-paper); /* 淡淡紙紋紋理 - 使用真實圖片 */
    background-size: cover; /* 覆蓋整個卡片 */
    background-position: center;
    background-repeat: no-repeat;
    /* 使用 blend mode 讓紙紋淡淡的不明顯 */
    background-blend-mode: overlay; /* 淡淡混合，不明顯 */
    border: 1px solid var(--color-border-subtle); /* 極淡的褐色邊框 */
    border-radius: var(--radius-card); /* 24px 超橢圓圓角 */

    /* 微妙的玻璃質感層 - 淡淡的不明顯 */
    &::before {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--gradient-card);
      backdrop-filter: var(--glass-blur-subtle);
      -webkit-backdrop-filter: var(--glass-blur-subtle);
      border-radius: var(--radius-card);
      z-index: 0;
      pointer-events: none;
      opacity: 0.25; /* 降低不透明度，讓紙紋自然透過 */
      border: 1px solid var(--glass-border-subtle); /* 晨曦金邊框光暈 */
      mix-blend-mode: soft-light; /* 柔和混合 */
    }

    /* Shadow system using warm brown shadow */
    box-shadow: var(--shadow-card);
    position: relative; /* 確保 ::before 定位正確 */

    /* Existing styles... */
    overflow: hidden;
    
    /* 確保內容在所有背景層之上 */
    > * {
      position: relative;
      z-index: 2; /* 提高 z-index，確保在所有背景層之上 */
    }
    transition: transform var(--transition-hover), box-shadow var(--transition-hover), border-color var(--transition-hover);
    /* GPU acceleration for smooth animations */
    transform: translate3d(0, 0, 0);
    will-change: transform, box-shadow;

    /* Hover state - Enhanced card lift with warm shadow */
    &:hover {
      transform: var(--transform-lift-card); /* 懸停浮起 */
      border-color: var(--palette-morning-gold); /* 晨曦金邊框 */
      box-shadow: var(--shadow-card-hover), var(--shadow-glow);

      /* 玻璃效果增強 */
      &::before {
        opacity: 0.75; /* 更明顯的玻璃層 */
        background: var(--gradient-card), var(--glass-subtle);
      }
      
      /* 確保所有文字在 hover 時清晰可見 - 使用更深的顏色 */
      .card__title,
      h1, h2, h3, h4, h5, h6 {
        color: var(--palette-deep-brown) !important; /* 強制使用深褐，最高對比度 */
        opacity: 1 !important; /* 確保完全不透明 */
        font-weight: var(--font-weight-bold); /* 加粗字體 */
      }
      
      .card__body,
      .card__price,
      .card__desc,
      p, span {
        color: var(--palette-deep-gray) !important; /* 強制使用深灰，確保可見 */
        opacity: 1 !important; /* 確保完全不透明 */
      }
      
      a {
        color: var(--palette-morning-gold) !important; /* 連結使用晨曦金 */
        opacity: 1 !important;
      }
    }

    /* Focus state - For keyboard navigation */
    &:focus-visible {
      outline: 3px solid var(--focus-ring);
      outline-offset: 3px;
    }
  }
  
  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .card,
    .c-card {
      transition: box-shadow var(--transition-hover);
      transform: none;
      will-change: auto;
      
      &:hover {
        transform: none;
      }
      
      .card__image img {
        transform: none;
        will-change: auto;
      }
      
      &:hover .card__image img {
        transform: none;
      }
    }
  }
  
  /* Card Body - Main content area */
  .card__body {
    padding: var(--space-6);
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  /* Card Title - 確保清晰可見 */
  .card__title {
    margin: 0 0 var(--space-3) 0;
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    line-height: var(--line-height-tight);
    color: var(--palette-deep-brown) !important; /* 強制使用深褐，最高對比度 */
    opacity: 1 !important; /* 確保完全不透明 */
  }
  
  /* Card Subtitle - 確保清晰可見 */
  .card__subtitle {
    margin: 0 0 var(--space-4) 0;
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold); /* 加粗字體 */
    line-height: var(--line-height-relaxed);
    color: var(--palette-deep-gray) !important; /* 強制使用深灰，確保可見 */
    opacity: 1 !important; /* 確保完全不透明 */
  }
  
  /* Card Content - Body text - 確保清晰可見 */
  .card__content {
    margin: 0;
    font-size: var(--font-size-base);
    line-height: var(--line-height-relaxed);
    color: var(--palette-deep-gray) !important; /* 強制使用深灰，確保可見 */
    opacity: 1 !important; /* 確保完全不透明 */
    flex: 1;
    font-weight: var(--font-weight-medium); /* 加粗字體 */
  }
  
  /* Card Body - 確保所有文字清晰可見 */
  .card__body {
    color: var(--palette-deep-gray) !important; /* 深灰文字 */
    opacity: 1 !important;
  }
  
  .card__body h1,
  .card__body h2,
  .card__body h3,
  .card__body h4,
  .card__body h5,
  .card__body h6,
  .card__body .card__title {
    color: var(--palette-deep-brown) !important; /* 深褐標題 */
    opacity: 1 !important;
    font-weight: var(--font-weight-bold) !important;
  }
  
  .card__body p,
  .card__body span,
  .card__body .card__content,
  .card__body .card__desc {
    color: var(--palette-deep-gray) !important; /* 深灰文字 */
    opacity: 1 !important;
    font-weight: var(--font-weight-medium) !important; /* 加粗字體 */
  }
  
  .card__body a {
    color: var(--palette-morning-gold) !important; /* 連結使用晨曦金 */
    opacity: 1 !important;
  }
  
  /* Card Footer - Actions or metadata */
  .card__footer {
    padding: var(--space-4) var(--space-6) var(--space-6);
    margin-top: auto;
    border-top: 1px solid var(--color-border-subtle);
  }
  
  /* Card Image - Image container */
  .card__image {
    width: 100%;
    overflow: hidden;
    background-color: var(--color-neutral-100);
    
    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.3s ease;
    }
    
    /* Image zoom on card hover - GPU accelerated */
    img {
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      will-change: transform;
    }
    
    .card:hover & img {
      transform: scale3d(1.05, 1.05, 1);
    }
  }
  
  /* Card Media - Grid of images */
  .card__media {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-3);
    /* Fixed height for media container to ensure consistent card sizes */
    height: 400px; /* Fixed height for all image grids */
    
    img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Preserve original aspect ratio, don't crop */
      object-position: center center;
      border-radius: var(--radius-md);
      display: block;
      background-color: var(--color-neutral-100); /* Background for letterboxing */
    }
    
    /* Responsive height adjustments */
    @media (min-width: 768px) {
      height: 450px; /* Slightly larger on desktop */
    }
    
    @media (min-width: 992px) {
      height: 500px; /* Even larger on wide screens */
    }
  }
  
  
  /* ============================================
   * Card Variants
   * ============================================ */
  
  /* Split Layout Modifier - For two-column cards */
  .card--split {
    @media (min-width: 768px) {
      flex-direction: row;
      align-items: stretch; /* Ensure cards have equal height */
      min-height: 600px; /* Minimum height to ensure consistency */
      
      .card__body {
        flex: 0 0 45%;
        padding: var(--space-8);
        display: flex;
        flex-direction: column;
      }
      
      .card__media {
        flex: 0 0 55%;
        padding: var(--space-8);
        align-self: stretch; /* Stretch to match card height */
        display: grid; /* Ensure grid layout is maintained */
        align-content: start; /* Align grid items to top */
        /* Height is already set in .card__media above */
      }
    }
  }
  
  /* Service Card - For price/service listings */
  .card--service {
    /* Uses base card styles with split modifier support */
  }
  
  /* Service Card Price */
  .card__price {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-brand-accent);
    margin: var(--space-2) 0;
    line-height: var(--line-height-tight);
  }
  
  .card__price-unit {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-normal);
    color: var(--color-text-subtle);
  }
  
  .card__price-tag {
    display: inline-block;
    margin-top: var(--space-2);
    padding: var(--space-1) var(--space-3);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    background-color: var(--color-surface-2);
    border-radius: var(--radius-sm);
    color: var(--color-brand-accent);
  }
  
  
  /* Team Card - For team member profiles */
  .card--team {
    text-align: center;
    text-decoration: none;
    color: inherit;
    
    .card__image {
      aspect-ratio: 3 / 4; /* Portrait orientation - 3:4 ratio */
      border-radius: var(--radius-card) var(--radius-card) 0 0;
      overflow: hidden;
      
      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center center;
      }
      
      /* Fix for rotated images - rotate counter-clockwise 90 degrees to correct orientation */
      img.img-rotate-fix {
        transform: rotate(-90deg);
        /* Scale up significantly to fill container after rotation */
        /* When rotating 90deg, need to scale by the aspect ratio to fill properly */
        width: 177.78%; /* Scale to fill: sqrt(4^2 + 3^2) / 3 ≈ 1.7778 for 3:4 container */
        height: 177.78%;
        /* Adjust positioning to center after rotation */
        object-fit: cover;
        object-position: center center;
        /* Ensure the rotated image fills the container completely */
        transform-origin: center center;
      }
    }
    
    .card__body {
      padding: var(--space-4) var(--space-4) var(--space-5);
    }
    
    .card__title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      margin: var(--space-3) 0 var(--space-1) 0;
      color: var(--color-text);
    }
    
    .card__subtitle {
      font-size: var(--font-size-sm);
      color: var(--color-text-subtle);
      margin: 0;
    }
  }
  
  
  /* Testimonial Card - For customer quotes */
  .card--testimonial {
    background-color: var(--color-surface);
    border-left: 4px solid var(--color-brand-cta);
    font-style: italic;
    
    .card__body {
      padding: var(--space-6);
    }
    
    .card__content {
      font-size: var(--font-size-lg);
      line-height: var(--line-height-loose);
      color: var(--color-text);
      margin-bottom: var(--space-4);
    }
    
    .card__footer {
      border-top: none;
      padding-top: 0;
      padding-bottom: 0;
      font-style: normal;
    }
    
    .card__author {
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      color: var(--color-text-subtle);
      margin: 0;
    }
  }
  
  
  /* Booking Card - For location/store selection */
  .card--booking {
    text-decoration: none;
    color: inherit;
    
    .card__image {
      aspect-ratio: 16 / 10;
    }
    
    .card__body {
      padding: var(--space-5) var(--space-6);
    }
    
    .card__title {
      font-size: var(--font-size-2xl);
      margin-bottom: var(--space-3);
    }
    
    .card__content {
      font-size: var(--font-size-base);
      color: var(--color-text-subtle);
      margin-bottom: 0;
    }
    
    .card__footer {
      padding: 0 var(--space-6) var(--space-6);
    }
    
    .card__action {
      display: inline-block;
      padding: var(--space-2) var(--space-5);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      text-align: center;
      background-color: var(--color-brand-cta);
      color: var(--color-text-on-dark); /* 確保文字顏色正確 */
      border-radius: var(--radius-md);
      transition: background-color 0.2s ease, color 0.2s ease;
      opacity: 1; /* 確保完全不透明 */
    }
    
    &:hover .card__action {
      background-color: var(--color-brand-cta-hover); /* 晨曦金 hover */
      color: var(--color-text-on-dark); /* 確保文字清晰可見 */
      opacity: 1; /* 確保完全不透明 */
    }
  }
  
  
  /* ============================================
   * Legacy Support
   * ============================================ */
  
  /* Support old .c-card class names during migration */
  /* These map to new .card classes for backward compatibility */
  .c-card {
    display: flex;
    flex-direction: column;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-card);
    /* Multi-layer shadow system for depth */
    box-shadow:
      var(--shadow-soft),                    /* Outer shadow - main depth */
      inset 0 1px 0 rgba(255, 255, 255, 0.1), /* Inner highlight - subtle top edge */
      0 0 0 1px rgba(0, 0, 0, 0.02);        /* Border shadow - subtle edge definition */
    overflow: hidden;
    transition: transform var(--transition-hover), box-shadow var(--transition-hover);
    /* GPU acceleration for smooth animations */
    transform: translate3d(0, 0, 0);
    will-change: transform, box-shadow;
    
    &:hover {
      transform: var(--transform-lift-card);
      box-shadow:
        var(--shadow-hover),                 /* Enhanced outer shadow */
        inset 0 1px 0 rgba(255, 255, 255, 0.1), /* Maintain inner highlight */
        0 0 0 1px rgba(0, 0, 0, 0.02);      /* Maintain border shadow */
    }
  }
  
  .c-card--split {
    @media (min-width: 768px) {
      flex-direction: row;
      align-items: stretch; /* Ensure cards have equal height */
      min-height: 600px; /* Minimum height to ensure consistency */
      
      .c-card__body {
        flex: 0 0 45%;
        padding: var(--space-8);
        display: flex;
        flex-direction: column;
      }
      
      .c-card__media {
        flex: 0 0 55%;
        padding: var(--space-8);
        align-self: stretch; /* Stretch to match card height */
        display: grid; /* Ensure grid layout is maintained */
        align-content: start; /* Align grid items to top */
        /* Height is already set in .c-card__media above */
      }
    }
  }
  
  .c-card__body {
    padding: var(--space-6);
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .c-card__title {
    margin: 0 0 var(--space-3) 0;
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    line-height: var(--line-height-tight);
    color: var(--color-brand-primary);
  }
  
  .c-card__media {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-3);
    /* Fixed height for media container to ensure consistent card sizes */
    height: 400px; /* Fixed height for all image grids */
    
    img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Preserve original aspect ratio, don't crop */
      object-position: center center;
      border-radius: var(--radius-md);
      display: block;
      background-color: var(--color-neutral-100); /* Background for letterboxing */
    }
    
    /* Responsive height adjustments */
    @media (min-width: 768px) {
      height: 450px; /* Slightly larger on desktop */
    }
    
    @media (min-width: 992px) {
      height: 500px; /* Even larger on wide screens */
    }
  }
  
  .c-card__price {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-brand-accent);
    margin: var(--space-2) 0;
    line-height: var(--line-height-tight);
  }
  
  .c-card__price-unit {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-normal);
    color: var(--color-text-subtle);
  }
  
  .c-card__price-tag {
    display: inline-block;
    margin-top: var(--space-2);
    padding: var(--space-1) var(--space-3);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    background-color: var(--color-surface-2);
    border-radius: var(--radius-sm);
    color: var(--color-brand-accent);
  }
  
}

